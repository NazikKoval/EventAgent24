var wysihtml5={version:"0.4.0pre",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"\ufeff",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};window.rangy=function(){function h(c,d){var e=typeof c[d];return e==b||!(e!=a||!c[d])||"unknown"==e}function i(b,c){return!(typeof b[c]!=a||!b[c])}function j(a,b){return typeof a[b]!=c}function k(a){return function(b,c){for(var d=c.length;d--;)if(!a(b,c[d]))return!1;return!0}}function o(a){return a&&l(a,g)&&n(a,f)}function q(a){window.alert("Rangy not supported in your browser. Reason: "+a),p.initialized=!0,p.supported=!1}function r(a){var b="Rangy warning: "+a;p.config.alertOnWarn?window.alert(b):typeof window.console!=c&&typeof window.console.log!=c&&window.console.log(b)}function u(){if(!p.initialized){var a,b=!1,c=!1;h(document,"createRange")&&(a=document.createRange(),l(a,e)&&n(a,d)&&(b=!0),a.detach());var f=i(document,"body")?document.body:document.getElementsByTagName("body")[0];f&&h(f,"createTextRange")&&(a=f.createTextRange(),o(a)&&(c=!0)),b||c||q("Neither Range nor TextRange are implemented"),p.initialized=!0,p.features={implementsDomRange:b,implementsTextRange:c};for(var g=t.concat(s),j=0,k=g.length;j<k;++j)try{g[j](p)}catch(a){i(window,"console")&&h(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",a)}}}function w(a){a=a||window,u();for(var b=0,c=v.length;b<c;++b)v[b](a)}function x(a){this.name=a,this.initialized=!1,this.supported=!1}var a="object",b="function",c="undefined",d=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestortoolbar:{}Container","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],e=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],f=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],g=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],l=k(h),m=k(i),n=k(j),p={version:"1.2.2",initialized:!1,supported:!0,util:{isHostMethod:h,isHostObject:i,isHostProperty:j,areHostMethods:l,areHostObjects:m,areHostProperties:n,isTextRange:o},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};p.fail=q,p.warn=r,{}.hasOwnProperty?p.util.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}:q("hasOwnProperty not supported");var s=[],t=[];p.init=u,p.addInitListener=function(a){p.initialized?a(p):s.push(a)};var v=[];p.addCreateMissingNativeApiListener=function(a){v.push(a)},p.createMissingNativeApi=w,x.prototype.fail=function(a){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+a)},x.prototype.warn=function(a){p.warn("Module "+this.name+": "+a)},x.prototype.createError=function(a){return new Error("Error in Rangy "+this.name+" module: "+a)},p.createModule=function(a,b){var c=new x(a);p.modules[a]=c,t.push(function(a){b(a,c),c.initialized=!0,c.supported=!0})},p.requireModules=function(a){for(var d,e,b=0,c=a.length;b<c;++b){if(e=a[b],d=p.modules[e],!(d&&d instanceof x))throw new Error("Module '"+e+"' not found");if(!d.supported)throw new Error("Module '"+e+"' not supported")}};var y=!1,z=function(a){y||(y=!0,p.initialized||u())};return typeof window==c?void q("No window found"):typeof document==c?void q("No document found"):(h(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",z,!1),h(window,"addEventListener")?window.addEventListener("load",z,!1):h(window,"attachEvent")?window.attachEvent("onload",z):q("Window does not have required addEventListener or attachEvent method"),p)}(),rangy.createModule("DomUtil",function(a,b){function h(a){var b;return typeof a.namespaceURI==c||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==b}function i(a){var b=a.parentNode;return 1==b.nodeType?b:null}function j(a){for(var b=0;a=a.previousSibling;)b++;return b}function k(a){var b;return o(a)?a.length:(b=a.childNodes)?b.length:0}function l(a,b){var d,c=[];for(d=a;d;d=d.parentNode)c.push(d);for(d=b;d;d=d.parentNode)if(g(c,d))return d;return null}function m(a,b,c){for(var d=c?b:b.parentNode;d;){if(d===a)return!0;d=d.parentNode}return!1}function n(a,b,c){for(var d,e=c?a:a.parentNode;e;){if(d=e.parentNode,d===b)return e;e=d}return null}function o(a){var b=a.nodeType;return 3==b||4==b||8==b}function p(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a}function q(a,b){var c=a.cloneNode(!1);return c.deleteData(0,b),a.deleteData(b,a.length-b),p(c,a),c}function r(a){if(9==a.nodeType)return a;if(typeof a.ownerDocument!=c)return a.ownerDocument;if(typeof a.document!=c)return a.document;if(a.parentNode)return r(a.parentNode);throw new Error("getDocument: no document found for node")}function s(a){var b=r(a);if(typeof b.defaultView!=c)return b.defaultView;if(typeof b.parentWindow!=c)return b.parentWindow;throw new Error("Cannot get a window object for node")}function t(a){if(typeof a.contentDocument!=c)return a.contentDocument;if(typeof a.contentWindow!=c)return a.contentWindow.document;throw new Error("getIframeWindow: No Document object found for iframe element")}function u(a){if(typeof a.contentWindow!=c)return a.contentWindow;if(typeof a.contentDocument!=c)return a.contentDocument.defaultView;throw new Error("getIframeWindow: No Window object found for iframe element")}function v(a){return d.isHostObject(a,"body")?a.body:a.getElementsByTagName("body")[0]}function w(a){for(var b;b=a.parentNode;)a=b;return a}function x(a,b,c,d){var e,f,g,h,i;if(a==c)return b===d?0:b<d?-1:1;if(e=n(c,a,!0))return b<=j(e)?-1:1;if(e=n(a,c,!0))return j(e)<d?-1:1;if(f=l(a,c),g=a===f?f:n(a,f,!0),h=c===f?f:n(c,f,!0),g===h)throw new Error("comparePoints got to case 4 and childA and childB are the same!");for(i=f.firstChild;i;){if(i===g)return-1;if(i===h)return 1;i=i.nextSibling}throw new Error("Should not be here!")}function y(a){for(var c,b=r(a).createDocumentFragment();c=a.firstChild;)b.appendChild(c);return b}function z(a){if(!a)return"[No node]";if(o(a))return'"'+a.data+'"';if(1==a.nodeType){var b=a.id?' id="'+a.id+'"':"";return"<"+a.nodeName+b+">["+a.childNodes.length+"]"}return a.nodeName}function A(a){this.root=a,this._next=a}function B(a){return new A(a)}function C(a,b){this.node=a,this.offset=b}function D(a){this.code=this[a],this.codeName=a,this.message="DOMException: "+this.codeName}var c="undefined",d=a.util;d.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method"),d.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var e=document.createElement("div");d.areHostMethods(e,["insertBefore","appendChild","cloneNode"]||!d.areHostObjects(e,["previousSibling","nextSibling","childNodes","parentNode"]))||b.fail("Incomplete Element implementation"),d.isHostProperty(e,"innerHTML")||b.fail("Element is missing innerHTML property");var f=document.createTextNode("test");d.areHostMethods(f,["splitText","deleteData","insertData","appendData","cloneNode"]||!d.areHostObjects(e,["previousSibling","nextSibling","childNodes","parentNode"])||!d.areHostProperties(f,["data"]))||b.fail("Incomplete Text Node implementation");var g=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1};A.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var b,c,a=this._current=this._next;if(this._current)if(b=a.firstChild)this._next=b;else{for(c=null;a!==this.root&&!(c=a.nextSibling);)a=a.parentNode;this._next=c}return this._current},detach:function(){this._current=this._next=this.root=null}},C.prototype={equals:function(a){return this.node===a.node&this.offset==a.offset},inspect:function(){return"[DomPosition("+z(this.node)+":"+this.offset+")]"}},D.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},D.prototype.toString=function(){return this.message},a.dom={arrayContains:g,isHtmlNamespace:h,parentElement:i,getNodeIndex:j,getNodeLength:k,getCommonAncestor:l,isAncestorOf:m,getClosestAncestorIn:n,isCharacterDataNode:o,insertAfter:p,splitDataNode:q,getDocument:r,getWindow:s,getIframeWindow:u,getIframeDocument:t,getBody:v,getRootContainer:w,comparePoints:x,inspectNode:z,fragmentFromNodeChildren:y,createIterator:B,DomPosition:C},a.DOMException=D}),rangy.createModule("DomRange",function(a,b){function f(a,b){return 3!=a.nodeType&&(c.isAncestorOf(a,b.startContainer,!0)||c.isAncestorOf(a,b.endContainer,!0))}function g(a){return c.getDocument(a.startContainer)}function h(a,b,c){var d=a._listeners[b];if(d)for(var e=0,f=d.length;e<f;++e)d[e].call(a,{target:a,args:c})}function i(a){return new d(a.parentNode,c.getNodeIndex(a))}function j(a){return new d(a.parentNode,c.getNodeIndex(a)+1)}function k(a,b,d){var e=11==a.nodeType?a.firstChild:a;return c.isCharacterDataNode(b)?d==b.length?c.insertAfter(a,b):b.parentNode.insertBefore(a,0==d?b:c.splitDataNode(b,d)):d>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[d]),e}function l(a){for(var b,c,f,d=g(a.range).createDocumentFragment();c=a.next();){if(b=a.isPartiallySelectedSubtree(),c=c.cloneNode(!b),b&&(f=a.getSubtreeIterator(),c.appendChild(l(f)),f.detach(!0)),10==c.nodeType)throw new e("HIERARCHY_REQUEST_ERR");d.appendChild(c)}return d}function m(a,b,d){var e,f;d=d||{stop:!1};for(var g,h;g=a.next();)if(a.isPartiallySelectedSubtree()){if(b(g)===!1)return void(d.stop=!0);if(h=a.getSubtreeIterator(),m(h,b,d),h.detach(!0),d.stop)return}else for(e=c.createIterator(g);f=e.next();)if(b(f)===!1)return void(d.stop=!0)}function n(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),n(b),b.detach(!0)):a.remove()}function o(a){for(var b,d,c=g(a.range).createDocumentFragment();b=a.next();){if(a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),d=a.getSubtreeIterator(),b.appendChild(o(d)),d.detach(!0)):a.remove(),10==b.nodeType)throw new e("HIERARCHY_REQUEST_ERR");c.appendChild(b)}return c}function p(a,b,c){var e,d=!(!b||!b.length),f=!!c;d&&(e=new RegExp("^("+b.join("|")+")$"));var g=[];return m(new r(a,!1),function(a){d&&!e.test(a.nodeType)||f&&!c(a)||g.push(a)}),g}function q(a){var b="undefined"==typeof a.getName?"Range":a.getName();return"["+b+"("+c.inspectNode(a.startContainer)+":"+a.startOffset+", "+c.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function r(a,b){if(this.range=a,this.clonePartiallySelectedTextNodes=b,!a.collapsed){this.sc=a.startContainer,this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset;var d=a.commonAncestorContainer;this.sc===this.ec&&c.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==d||c.isCharacterDataNode(this.sc)?c.getClosestAncestorIn(this.sc,d,!0):this.sc.childNodes[this.so],this._last=this.ec!==d||c.isCharacterDataNode(this.ec)?c.getClosestAncestorIn(this.ec,d,!0):this.ec.childNodes[this.eo-1])}}function s(a){this.code=this[a],this.codeName=a,this.message="RangeException: "+this.codeName}function t(a,b,c){this.nodes=p(a,b,c),this._next=this.nodes[0],this._position=0}function z(a){return function(b,d){for(var e,f=d?b:b.parentNode;f;){if(e=f.nodeType,c.arrayContains(a,e))return f;f=f.parentNode}return null}}function E(a,b){if(D(a,b))throw new s("INVALID_NODE_TYPE_ERR")}function F(a){if(!a.startContainer)throw new e("INVALID_STATE_ERR")}function G(a,b){if(!c.arrayContains(b,a.nodeType))throw new s("INVALID_NODE_TYPE_ERR")}function H(a,b){if(b<0||b>(c.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new e("INDEX_SIZE_ERR")}function I(a,b){if(B(a,!0)!==B(b,!0))throw new e("WRONG_DOCUMENT_ERR")}function J(a){if(C(a,!0))throw new e("NO_MODIFICATION_ALLOWED_ERR")}function K(a,b){if(!a)throw new e(b)}function L(a){return!c.arrayContains(v,a.nodeType)&&!B(a,!0)}function M(a,b){return b<=(c.isCharacterDataNode(a)?a.length:a.childNodes.length)}function N(a){if(F(a),L(a.startContainer)||L(a.endContainer)||!M(a.startContainer,a.startOffset)||!M(a.endContainer,a.endOffset))throw new Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")")}function $(){}function _(a){a.START_TO_START=S,a.START_TO_END=T,a.END_TO_END=U,a.END_TO_START=V,a.NODE_BEFORE=W,a.NODE_AFTER=X,a.NODE_BEFORE_AND_AFTER=Y,a.NODE_INSIDE=Z}function aa(a){_(a),_(a.prototype)}function ba(a,b){return function(){N(this);var h,i,d=this.startContainer,e=this.startOffset,f=this.commonAncestorContainer,g=new r(this,!0);d!==f&&(h=c.getClosestAncestorIn(d,f,!0),i=j(h),d=i.node,e=i.offset),m(g,J),g.reset();var k=a(g);return g.detach(),b(this,d,e,d,e),k}}function ca(b,d,e){function g(a,b){return function(c){F(this),G(c,u),G(A(c),v);var d=(a?i:j)(c);(b?h:k)(this,d.node,d.offset)}}function h(a,b,e){var f=a.endContainer,g=a.endOffset;b===a.startContainer&&e===a.startOffset||(A(b)==A(f)&&1!=c.comparePoints(b,e,f,g)||(f=b,g=e),d(a,b,e,f,g))}function k(a,b,e){var f=a.startContainer,g=a.startOffset;b===a.endContainer&&e===a.endOffset||(A(b)==A(f)&&c.comparePoints(b,e,f,g)!=-1||(f=b,g=e),d(a,f,g,b,e))}function l(a,b,c){b===a.startContainer&&c===a.startOffset&&b===a.endContainer&&c===a.endOffset||d(a,b,c,b,c)}b.prototype=new $,a.util.extend(b.prototype,{setStart:function(a,b){F(this),E(a,!0),H(a,b),h(this,a,b)},setEnd:function(a,b){F(this),E(a,!0),H(a,b),k(this,a,b)},setStartBefore:g(!0,!0),setStartAfter:g(!1,!0),setEndBefore:g(!0,!1),setEndAfter:g(!1,!1),collapse:function(a){N(this),a?d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){F(this),E(a,!0),d(this,a,0,a,c.getNodeLength(a))},selectNode:function(a){F(this),E(a,!1),G(a,u);var b=i(a),c=j(a);d(this,b.node,b.offset,c.node,c.offset)},extractContents:ba(o,d),deleteContents:ba(n,d),canSurroundContents:function(){N(this),J(this.startContainer),J(this.endContainer);var a=new r(this,!0),b=a._first&&f(a._first,this)||a._last&&f(a._last,this);return a.detach(),!b},detach:function(){e(this)},splitBoundaries:function(){N(this);var a=this.startContainer,b=this.startOffset,e=this.endContainer,f=this.endOffset,g=a===e;c.isCharacterDataNode(e)&&f>0&&f<e.length&&c.splitDataNode(e,f),c.isCharacterDataNode(a)&&b>0&&b<a.length&&(a=c.splitDataNode(a,b),g?(f-=b,e=a):e==a.parentNode&&f>=c.getNodeIndex(a)&&f++,b=0),d(this,a,b,e,f)},normalizeBoundaries:function(){N(this);var a=this.startContainer,b=this.startOffset,e=this.endContainer,f=this.endOffset,g=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(e=a,f=a.length,a.appendData(b.data),b.parentNode.removeChild(b))},h=function(d){var g=d.previousSibling;if(g&&g.nodeType==d.nodeType){a=d;var h=d.length;if(b=g.length,d.insertData(0,g.data),g.parentNode.removeChild(g),a==e)f+=b,e=a;else if(e==d.parentNode){var i=c.getNodeIndex(d);f==i?(e=d,f=h):f>i&&f--}}},i=!0;if(c.isCharacterDataNode(e))e.length==f&&g(e);else{if(f>0){var j=e.childNodes[f-1];j&&c.isCharacterDataNode(j)&&g(j)}i=!this.collapsed}if(i){if(c.isCharacterDataNode(a))0==b&&h(a);else if(b<a.childNodes.length){var k=a.childNodes[b];k&&c.isCharacterDataNode(k)&&h(k)}}else a=e,b=f;d(this,a,b,e,f)},collapseToPoint:function(a,b){F(this),E(a,!0),H(a,b),l(this,a,b)}}),aa(b)}function da(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a.commonAncestorContainer=a.collapsed?a.startContainer:c.getCommonAncestor(a.startContainer,a.endContainer)}function ea(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!==c,g=a.endContainer!==d||a.endOffset!==e;a.startContainer=b,a.startOffset=c,a.endContainer=d,a.endOffset=e,da(a),h(a,"boundarychange",{startMoved:f,endMoved:g})}function fa(a){F(a),a.startContainer=a.startOffset=a.endContainer=a.endOffset=null,a.collapsed=a.commonAncestorContainer=null,h(a,"detach",null),a._listeners=null}function ga(a){this.startContainer=a,this.startOffset=0,this.endContainer=a,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},da(this)}a.requireModules(["DomUtil"]);var c=a.dom,d=c.DomPosition,e=a.DOMException;r.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;return a&&(this._next=a!==this._last?a.nextSibling:null,c.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so))),a},remove:function(){var b,d,a=this._current;!c.isCharacterDataNode(a)||a!==this.sc&&a!==this.ec?a.parentNode&&a.parentNode.removeChild(a):(b=a===this.sc?this.so:0,d=a===this.ec?this.eo:a.length,b!=d&&a.deleteData(b,d-b))},isPartiallySelectedSubtree:function(){var a=this._current;return f(a,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse();else{a=new ga(g(this.range));var b=this._current,d=b,e=0,f=b,h=c.getNodeLength(b);c.isAncestorOf(b,this.sc,!0)&&(d=this.sc,e=this.so),c.isAncestorOf(b,this.ec,!0)&&(f=this.ec,h=this.eo),ea(a,d,e,f,h)}return new r(a,this.clonePartiallySelectedTextNodes)},detach:function(a){a&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},s.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},s.prototype.toString=function(){return this.message},t.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var u=[1,3,4,5,7,8,10],v=[2,9,11],w=[5,6,10,12],x=[1,3,4,5,7,8,10,11],y=[1,3,4,5,7,8],A=c.getRootContainer,B=z([9,11]),C=z(w),D=z([6,10,12]),O=document.createElement("style"),P=!1;try{O.innerHTML="<b>x</b>",P=3==O.firstChild.nodeType}catch(a){}a.features.htmlParsingConforms=P;var Q=P?function(a){var b=this.startContainer,d=c.getDocument(b);if(!b)throw new e("INVALID_STATE_ERR");var f=null;return 1==b.nodeType?f=b:c.isCharacterDataNode(b)&&(f=c.parentElement(b)),f=null===f||"HTML"==f.nodeName&&c.isHtmlNamespace(c.getDocument(f).documentElement)&&c.isHtmlNamespace(f)?d.createElement("body"):f.cloneNode(!1),f.innerHTML=a,c.fragmentFromNodeChildren(f)}:function(a){F(this);var b=g(this),d=b.createElement("body");return d.innerHTML=a,c.fragmentFromNodeChildren(d)},R=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],S=0,T=1,U=2,V=3,W=0,X=1,Y=2,Z=3;$.prototype={attachListener:function(a,b){this._listeners[a].push(b)},compareBoundaryPoints:function(a,b){N(this),I(this.startContainer,b.startContainer);var d,e,f,g,h=a==V||a==S?"start":"end",i=a==T||a==S?"start":"end";return d=this[h+"Container"],e=this[h+"Offset"],f=b[i+"Container"],g=b[i+"Offset"],c.comparePoints(d,e,f,g)},insertNode:function(a){if(N(this),G(a,x),J(this.startContainer),c.isAncestorOf(a,this.startContainer,!0))throw new e("HIERARCHY_REQUEST_ERR");var b=k(a,this.startContainer,this.startOffset);this.setStartBefore(b)},cloneContents:function(){N(this);var a,b;if(this.collapsed)return g(this).createDocumentFragment();if(this.startContainer===this.endContainer&&c.isCharacterDataNode(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=g(this).createDocumentFragment(),b.appendChild(a),b;var d=new r(this,!0);return a=l(d),d.detach(),a},canSurroundContents:function(){N(this),J(this.startContainer),J(this.endContainer);var a=new r(this,!0),b=a._first&&f(a._first,this)||a._last&&f(a._last,this);return a.detach(),!b},surroundContents:function(a){if(G(a,y),!this.canSurroundContents())throw new s("BAD_BOUNDARYPOINTS_ERR");var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);k(a,this.startContainer,this.startOffset),a.appendChild(b),this.selectNode(a)},cloneRange:function(){N(this);for(var c,a=new ga(g(this)),b=R.length;b--;)c=R[b],a[c]=this[c];return a},toString:function(){N(this);var a=this.startContainer;if(a===this.endContainer&&c.isCharacterDataNode(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[],d=new r(this,!0);return m(d,function(a){3!=a.nodeType&&4!=a.nodeType||b.push(a.data)}),d.detach(),b.join("")},compareNode:function(a){N(this);var b=a.parentNode,d=c.getNodeIndex(a);if(!b)throw new e("NOT_FOUND_ERR");var f=this.comparePoint(b,d),g=this.comparePoint(b,d+1);return f<0?g>0?Y:W:g>0?X:Z},comparePoint:function(a,b){return N(this),K(a,"HIERARCHY_REQUEST_ERR"),I(a,this.startContainer),c.comparePoints(a,b,this.startContainer,this.startOffset)<0?-1:c.comparePoints(a,b,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:Q,toHtml:function(){N(this);var a=g(this).createElement("div");return a.appendChild(this.cloneContents()),a.innerHTML},intersectsNode:function(a,b){if(N(this),K(a,"NOT_FOUND_ERR"),c.getDocument(a)!==g(this))return!1;var d=a.parentNode,e=c.getNodeIndex(a);K(d,"NOT_FOUND_ERR");var f=c.comparePoints(d,e,this.endContainer,this.endOffset),h=c.comparePoints(d,e+1,this.startContainer,this.startOffset);return b?f<=0&&h>=0:f<0&&h>0},isPointInRange:function(a,b){return N(this),K(a,"HIERARCHY_REQUEST_ERR"),I(a,this.startContainer),c.comparePoints(a,b,this.startContainer,this.startOffset)>=0&&c.comparePoints(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a,b){if(N(this),g(a)!=g(this))throw new e("WRONG_DOCUMENT_ERR");var d=c.comparePoints(this.startContainer,this.startOffset,a.endContainer,a.endOffset),f=c.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset);return b?d<=0&&f>=0:d<0&&f>0},intersection:function(a){if(this.intersectsRange(a)){var b=c.comparePoints(this.startContainer,this.startOffset,a.startContainer,a.startOffset),d=c.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),e=this.cloneRange();return b==-1&&e.setStart(a.startContainer,a.startOffset),1==d&&e.setEnd(a.endContainer,a.endOffset),e}return null},union:function(a){if(this.intersectsRange(a,!0)){var b=this.cloneRange();return c.comparePoints(a.startContainer,a.startOffset,this.startContainer,this.startOffset)==-1&&b.setStart(a.startContainer,a.startOffset),1==c.comparePoints(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset),b}throw new s("Ranges do not intersect")},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==Z},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,c.getNodeLength(a))<=0},containsRange:function(a){return this.intersection(a).equals(a)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);if(c.length>0){b.setStart(c[0],0);var d=c.pop();b.setEnd(d,d.length);var e=this.containsRange(b);return b.detach(),e}return this.containsNodeContents(a)},createNodeIterator:function(a,b){return N(this),new t(this,a,b)},getNodes:function(a,b){return N(this),p(this,a,b)},getDocument:function(){return g(this)},collapseBefore:function(a){F(this),this.setEndBefore(a),this.collapse(!1)},collapseAfter:function(a){F(this),this.setStartAfter(a),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return ga.rangesEqual(this,a)},inspect:function(){return q(this)}},ca(ga,ea,fa),a.rangePrototype=$.prototype,ga.rangeProperties=R,ga.RangeIterator=r,ga.copyComparisonConstants=aa,ga.createPrototypeRange=ca,ga.inspect=q,ga.getRangeDocument=g,ga.rangesEqual=function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset},a.DomRange=ga,a.RangeException=s}),rangy.createModule("WrappedRange",function(a,b){function g(a){var b=a.parentElement(),c=a.duplicate();c.collapse(!0);var e=c.parentElement();c=a.duplicate(),c.collapse(!1);var f=c.parentElement(),g=e==f?e:d.getCommonAncestor(e,f);return g==b?g:d.getCommonAncestor(b,g)}function h(a){return 0==a.compareEndPoints("StartToEnd",a)}function i(a,b,c,f){var g=a.duplicate();g.collapse(c);var h=g.parentElement();if(d.isAncestorOf(b,h,!0)||(h=b),!h.canHaveHTML)return new e(h.parentNode,d.getNodeIndex(h));var j,l,m,n,o,i=d.getDocument(h).createElement("span"),k=c?"StartToStart":"StartToEnd";do h.insertBefore(i,i.previousSibling),g.moveToElementText(i);while((j=g.compareEndPoints(k,a))>0&&i.previousSibling);if(o=i.nextSibling,j==-1&&o&&d.isCharacterDataNode(o)){g.setEndPoint(c?"EndToStart":"EndToEnd",a);var p;if(/[\r\n]/.test(o.data)){var q=g.duplicate(),r=q.text.replace(/\r\n/g,"\r").length;for(p=q.moveStart("character",r);(j=q.compareEndPoints("StartToEnd",q))==-1;)p++,q.moveStart("character",1)}else p=g.text.length;n=new e(o,p)}else l=(f||!c)&&i.previousSibling,m=(f||c)&&i.nextSibling,n=m&&d.isCharacterDataNode(m)?new e(m,0):l&&d.isCharacterDataNode(l)?new e(l,l.length):new e(h,d.getNodeIndex(i));return i.parentNode.removeChild(i),n}function j(a,b){var c,e,h,i,f=a.offset,g=d.getDocument(a.node),j=g.body.createTextRange(),k=d.isCharacterDataNode(a.node);return k?(c=a.node,e=c.parentNode):(i=a.node.childNodes,c=f<i.length?i[f]:null,e=a.node),h=g.createElement("span"),h.innerHTML="&#feff;",c?e.insertBefore(h,c):e.appendChild(h),j.moveToElementText(h),j.collapse(!b),e.removeChild(h),k&&j[b?"moveStart":"moveEnd"]("character",f),j}a.requireModules(["DomUtil","DomRange"]);var c,d=a.dom,e=d.DomPosition,f=a.DomRange;if(!a.features.implementsDomRange||a.features.implementsTextRange&&a.config.preferTextRange){if(a.features.implementsTextRange){c=function(a){this.textRange=a,this.refresh()},c.prototype=new f(document),c.prototype.refresh=function(){var a,b,c=g(this.textRange);h(this.textRange)?b=a=i(this.textRange,c,!0,!0):(a=i(this.textRange,c,!0,!1),b=i(this.textRange,c,!1,!1)),this.setStart(a.node,a.offset),this.setEnd(b.node,b.offset)},f.copyComparisonConstants(c);var k=function(){return this}();"undefined"==typeof k.Range&&(k.Range=c),a.createNativeRange=function(a){return a=a||document,a.body.createTextRange()}}}else!function(){function h(a){for(var c,b=e.length;b--;)c=e[b],a[c]=a.nativeRange[c]}function i(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!=c,g=a.endContainer!==d||a.endOffset!=e;(f||g)&&(a.setEnd(d,e),a.setStart(b,c))}function j(a){a.nativeRange.detach(),a.detached=!0;for(var c,b=e.length;b--;)c=e[b],a[c]=null}var b,g,k,e=f.rangeProperties;c=function(a){if(!a)throw new Error("Range must be specified");this.nativeRange=a,h(this)},f.createPrototypeRange(c,i,j),b=c.prototype,b.selectNode=function(a){this.nativeRange.selectNode(a),h(this)},b.deleteContents=function(){this.nativeRange.deleteContents(),h(this)},b.extractContents=function(){var a=this.nativeRange.extractContents();return h(this),a},b.cloneContents=function(){return this.nativeRange.cloneContents()},b.surroundContents=function(a){this.nativeRange.surroundContents(a),h(this)},b.collapse=function(a){this.nativeRange.collapse(a),h(this)},b.cloneRange=function(){return new c(this.nativeRange.cloneRange())},b.refresh=function(){h(this)},b.toString=function(){return this.nativeRange.toString()};var l=document.createTextNode("test");d.getBody(document).appendChild(l);var m=document.createRange();m.setStart(l,0),m.setEnd(l,0);try{m.setStart(l,1),g=!0,b.setStart=function(a,b){this.nativeRange.setStart(a,b),h(this)},b.setEnd=function(a,b){this.nativeRange.setEnd(a,b),h(this)},k=function(a){return function(b){this.nativeRange[a](b),h(this)}}}catch(a){g=!1,b.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(c){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}h(this)},b.setEnd=function(a,b){try{this.nativeRange.setEnd(a,b)}catch(c){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}h(this)},k=function(a,b){return function(c){try{this.nativeRange[a](c)}catch(d){this.nativeRange[b](c),this.nativeRange[a](c)}h(this)}}}b.setStartBefore=k("setStartBefore","setEndBefore"),b.setStartAfter=k("setStartAfter","setEndAfter"),b.setEndBefore=k("setEndBefore","setStartBefore"),b.setEndAfter=k("setEndAfter","setStartAfter"),m.selectNodeContents(l),m.startContainer==l&&m.endContainer==l&&0==m.startOffset&&m.endOffset==l.length?b.selectNodeContents=function(a){this.nativeRange.selectNodeContents(a),h(this)}:b.selectNodeContents=function(a){this.setStart(a,0),this.setEnd(a,f.getEndOffset(a))},m.selectNodeContents(l),m.setEnd(l,3);var n=document.createRange();n.selectNodeContents(l),n.setEnd(l,4),n.setStart(l,2),m.compareBoundaryPoints(m.START_TO_END,n)==-1&1==m.compareBoundaryPoints(m.END_TO_START,n)?b.compareBoundaryPoints=function(a,b){return b=b.nativeRange||b,a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&(a=b.START_TO_END),this.nativeRange.compareBoundaryPoints(a,b)}:b.compareBoundaryPoints=function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)},a.util.isHostMethod(m,"createContextualFragment")&&(b.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)}),d.getBody(document).removeChild(l),m.detach(),n.detach()}(),a.createNativeRange=function(a){return a=a||document,a.createRange()};a.features.implementsTextRange&&(c.rangeToTextRange=function(a){if(a.collapsed){var b=j(new e(a.startContainer,a.startOffset),!0);return b}var c=j(new e(a.startContainer,a.startOffset),!0),f=j(new e(a.endContainer,a.endOffset),!1),g=d.getDocument(a.startContainer).body.createTextRange();return g.setEndPoint("StartToStart",c),g.setEndPoint("EndToEnd",f),g}),c.prototype.getName=function(){return"WrappedRange"},a.WrappedRange=c,a.createRange=function(b){return b=b||document,new c(a.createNativeRange(b))},a.createRangyRange=function(a){return a=a||document,new f(a)},a.createIframeRange=function(b){return a.createRange(d.getIframeDocument(b))},a.createIframeRangyRange=function(b){return a.createRangyRange(d.getIframeDocument(b))},a.addCreateMissingNativeApiListener(function(b){var c=b.document;"undefined"==typeof c.createRange&&(c.createRange=function(){return a.createRange(this)}),c=b=null})}),rangy.createModule("WrappedSelection",function(a,b){function n(a){return(a||window).getSelection()}function o(a){return(a||window).document.selection}function C(a,b,c){var d=c?"end":"start",e=c?"start":"end";a.anchorNode=b[d+"Container"],a.anchorOffset=b[d+"Offset"],a.focusNode=b[e+"Container"],a.focusOffset=b[e+"Offset"]}function D(a){var b=a.nativeSelection;a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset}function E(a){a.anchorNode=a.focusNode=null,a.anchorOffset=a.focusOffset=0,a.rangeCount=0,a.isCollapsed=!0,a._ranges.length=0}function F(b){var c;return b instanceof g?(c=b._selectionNativeRange,c||(c=a.createNativeRange(e.getDocument(b.startContainer)),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset),b._selectionNativeRange=c,b.attachListener("detach",function(){this._selectionNativeRange=null}))):b instanceof h?c=b.nativeRange:a.features.implementsDomRange&&b instanceof e.getWindow(b.startContainer).Range&&(c=b),c}function G(a){if(!a.length||1!=a[0].nodeType)return!1;for(var b=1,c=a.length;b<c;++b)if(!e.isAncestorOf(a[0],a[b]))return!1;return!0}function H(a){var b=a.getNodes();if(!G(b))throw new Error("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return b[0]}function I(a){return!!a&&"undefined"!=typeof a.text}function J(a,b){var c=new h(b);a._ranges=[c],C(a,c,!1),a.rangeCount=1,a.isCollapsed=c.collapsed}function K(b){
if(b._ranges.length=0,"None"==b.docSelection.type)E(b);else{var c=b.docSelection.createRange();if(I(c))J(b,c);else{b.rangeCount=c.length;for(var d,f=e.getDocument(c.item(0)),g=0;g<b.rangeCount;++g)d=a.createRange(f),d.selectNode(c.item(g)),b._ranges.push(d);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed,C(b,b._ranges[b.rangeCount-1],!1)}}}function L(a,b){for(var c=a.docSelection.createRange(),d=H(b),f=e.getDocument(c.item(0)),g=e.getBody(f).createControlRange(),h=0,i=c.length;h<i;++h)g.add(c.item(h));try{g.add(d)}catch(a){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}g.select(),K(a)}function N(a,b,c){this.nativeSelection=a,this.docSelection=b,this._ranges=[],this.win=c,this.refresh()}function P(a,b){for(var g,c=e.getDocument(b[0].startContainer),d=e.getBody(c).createControlRange(),f=0;f<rangeCount;++f){g=H(b[f]);try{d.add(g)}catch(a){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}d.select(),K(a)}function U(a,b){if(a.anchorNode&&e.getDocument(a.anchorNode)!==e.getDocument(b))throw new i("WRONG_DOCUMENT_ERR")}function V(a){var b=[],c=new j(a.anchorNode,a.anchorOffset),d=new j(a.focusNode,a.focusOffset),e="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var f=0,h=a.rangeCount;f<h;++f)b[f]=g.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.requireModules(["DomUtil","DomRange","WrappedRange"]),a.config.checkSelectionRanges=!0;var k,l,c="boolean",d="_rangySelection",e=a.dom,f=a.util,g=a.DomRange,h=a.WrappedRange,i=a.DOMException,j=e.DomPosition,m="Control",p=a.util.isHostMethod(window,"getSelection"),q=a.util.isHostObject(document,"selection"),r=q&&(!p||a.config.preferTextRange);r?(k=o,a.isSelectionValid=function(a){var b=(a||window).document,c=b.selection;return"None"!=c.type||e.getDocument(c.createRange().parentElement())==b}):p?(k=n,a.isSelectionValid=function(){return!0}):b.fail("Neither document.selection or window.getSelection() detected."),a.getNativeSelection=k;var s=k(),t=a.createNativeRange(document),u=e.getBody(document),v=f.areHostObjects(s,["anchorNode","focusNode"]&&f.areHostProperties(s,["anchorOffset","focusOffset"]));a.features.selectionHasAnchorAndFocus=v;var w=f.isHostMethod(s,"extend");a.features.selectionHasExtend=w;var x="number"==typeof s.rangeCount;a.features.selectionHasRangeCount=x;var y=!1,z=!0;f.areHostMethods(s,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof s.rangeCount&&a.features.implementsDomRange&&!function(){var a=document.createElement("iframe");u.appendChild(a);var b=e.getIframeDocument(a);b.open(),b.write("<html><head></head><body>12</body></html>"),b.close();var c=e.getIframeWindow(a).getSelection(),d=b.documentElement,f=d.lastChild,g=f.firstChild,h=b.createRange();h.setStart(g,1),h.collapse(!0),c.addRange(h),z=1==c.rangeCount,c.removeAllRanges();var i=h.cloneRange();h.setStart(g,0),i.setEnd(g,2),c.addRange(h),c.addRange(i),y=2==c.rangeCount,h.detach(),i.detach(),u.removeChild(a)}(),a.features.selectionSupportsMultipleRanges=y,a.features.collapsedNonEditableSelectionsSupported=z;var B,A=!1;u&&f.isHostMethod(u,"createControlRange")&&(B=u.createControlRange(),f.areHostProperties(B,["item","add"])&&(A=!0)),a.features.implementsControlRange=A,l=v?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return!!a.rangeCount&&a.getRangeAt(a.rangeCount-1).collapsed};var M;f.isHostMethod(s,"getRangeAt")?M=function(a,b){try{return a.getRangeAt(b)}catch(a){return null}}:v&&(M=function(b){var c=e.getDocument(b.anchorNode),d=a.createRange(c);return d.setStart(b.anchorNode,b.anchorOffset),d.setEnd(b.focusNode,b.focusOffset),d.collapsed!==this.isCollapsed&&(d.setStart(b.focusNode,b.focusOffset),d.setEnd(b.anchorNode,b.anchorOffset)),d}),a.getSelection=function(a){a=a||window;var b=a[d],c=k(a),e=q?o(a):null;return b?(b.nativeSelection=c,b.docSelection=e,b.refresh(a)):(b=new N(c,e,a),a[d]=b),b},a.getIframeSelection=function(b){return a.getSelection(e.getIframeWindow(b))};var O=N.prototype;if(!r&&v&&f.areHostMethods(s,["removeAllRanges","addRange"])){O.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),E(this)};var Q=function(b,c){var d=g.getRangeDocument(c),e=a.createRange(d);e.collapseToPoint(c.endContainer,c.endOffset),b.nativeSelection.addRange(F(e)),b.nativeSelection.extend(c.startContainer,c.startOffset),b.refresh()};x?O.addRange=function(b,c){if(A&&q&&this.docSelection.type==m)L(this,b);else if(c&&w)Q(this,b);else{var d;if(y?d=this.rangeCount:(this.removeAllRanges(),d=0),this.nativeSelection.addRange(F(b)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==d+1){if(a.config.checkSelectionRanges){var e=M(this.nativeSelection,this.rangeCount-1);e&&!g.rangesEqual(e,b)&&(b=new h(e))}this._ranges[this.rangeCount-1]=b,C(this,b,T(this.nativeSelection)),this.isCollapsed=l(this)}else this.refresh()}}:O.addRange=function(a,b){b&&w?Q(this,a):(this.nativeSelection.addRange(F(a)),this.refresh())},O.setRanges=function(a){if(A&&a.length>1)P(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}}}else{if(!(f.isHostMethod(s,"empty")&&f.isHostMethod(t,"select")&&A&&r))return b.fail("No means of selecting a Range or TextRange was found"),!1;O.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var a;if(this.anchorNode)a=e.getDocument(this.anchorNode);else if(this.docSelection.type==m){var b=this.docSelection.createRange();b.length&&(a=e.getDocument(b.item(0)).body.createTextRange())}if(a){var c=a.body.createTextRange();c.select(),this.docSelection.empty()}}}catch(a){}E(this)},O.addRange=function(a){this.docSelection.type==m?L(this,a):(h.rangeToTextRange(a).select(),this._ranges[0]=a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,C(this,a,!1))},O.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?P(this,a):b&&this.addRange(a[0])}}O.getRangeAt=function(a){if(a<0||a>=this.rangeCount)throw new i("INDEX_SIZE_ERR");return this._ranges[a]};var R;if(r)R=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=e.getBody(b.win.document).createTextRange(),c.collapse(!0)),b.docSelection.type==m?K(b):I(c)?J(b,c):E(b)};else if(f.isHostMethod(s,"getRangeAt")&&"number"==typeof s.rangeCount)R=function(b){if(A&&q&&b.docSelection.type==m)K(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,d=b.rangeCount;c<d;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));C(b,b._ranges[b.rangeCount-1],T(b.nativeSelection)),b.isCollapsed=l(b)}else E(b)};else{if(!v||typeof s.isCollapsed!=c||typeof t.collapsed!=c||!a.features.implementsDomRange)return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;R=function(a){var b,c=a.nativeSelection;c.anchorNode?(b=M(c,0),a._ranges=[b],a.rangeCount=1,D(a),a.isCollapsed=l(a)):E(a)}}O.refresh=function(a){var b=a?this._ranges.slice(0):null;if(R(this),a){var c=b.length;if(c!=this._ranges.length)return!1;for(;c--;)if(!g.rangesEqual(b[c],this._ranges[c]))return!1;return!0}};var S=function(a,b){var c=a.getAllRanges(),d=!1;a.removeAllRanges();for(var e=0,f=c.length;e<f;++e)d||b!==c[e]?a.addRange(c[e]):d=!0;a.rangeCount||E(a)};A?O.removeRange=function(a){if(this.docSelection.type==m){for(var g,b=this.docSelection.createRange(),c=H(a),d=e.getDocument(b.item(0)),f=e.getBody(d).createControlRange(),h=!1,i=0,j=b.length;i<j;++i)g=b.item(i),g!==c||h?f.add(b.item(i)):h=!0;f.select(),K(this)}else S(this,a)}:O.removeRange=function(a){S(this,a)};var T;!r&&v&&a.features.implementsDomRange?(T=function(a){var b=!1;return a.anchorNode&&(b=1==e.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)),b},O.isBackwards=function(){return T(this)}):T=O.isBackwards=function(){return!1},O.toString=function(){for(var a=[],b=0,c=this.rangeCount;b<c;++b)a[b]=""+this._ranges[b];return a.join("")},O.collapse=function(b,c){U(this,b);var d=a.createRange(e.getDocument(b));d.collapseToPoint(b,c),this.removeAllRanges(),this.addRange(d),this.isCollapsed=!0},O.collapseToStart=function(){if(!this.rangeCount)throw new i("INVALID_STATE_ERR");var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)},O.collapseToEnd=function(){if(!this.rangeCount)throw new i("INVALID_STATE_ERR");var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)},O.selectAllChildren=function(b){U(this,b);var c=a.createRange(e.getDocument(b));c.selectNodeContents(b),this.removeAllRanges(),this.addRange(c)},O.deleteFromDocument=function(){if(A&&q&&this.docSelection.type==m){for(var b,a=this.docSelection.createRange();a.length;)b=a.item(0),a.remove(b),b.parentNode.removeChild(b);this.refresh()}else if(this.rangeCount){var c=this.getAllRanges();this.removeAllRanges();for(var d=0,e=c.length;d<e;++d)c[d].deleteContents();this.addRange(c[e-1])}},O.getAllRanges=function(){return this._ranges.slice(0)},O.setSingleRange=function(a){this.setRanges([a])},O.containsNode=function(a,b){for(var c=0,d=this._ranges.length;c<d;++c)if(this._ranges[c].containsNode(a,b))return!0;return!1},O.toHtml=function(){var a="";if(this.rangeCount){for(var b=g.getRangeDocument(this._ranges[0]).createElement("div"),c=0,d=this._ranges.length;c<d;++c)b.appendChild(this._ranges[c].cloneContents());a=b.innerHTML}return a},O.getName=function(){return"WrappedSelection"},O.inspect=function(){return V(this)},O.detach=function(){this.win[d]=null,this.win=this.anchorNode=this.focusNode=null},N.inspect=V,a.Selection=N,a.selectionPrototype=O,a.addCreateMissingNativeApiListener(function(b){"undefined"==typeof b.getSelection&&(b.getSelection=function(){return a.getSelection(this)}),b=null})});var Base=function(){};Base.extend=function(a,b){var c=Base.prototype.extend;Base._prototyping=!0;var d=new this;c.call(d,a),d.base=function(){},delete Base._prototyping;var e=d.constructor,f=d.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==f)this._constructing=!0,e.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||c).call(arguments[0],d)};return f.ancestor=this,f.extend=this.extend,f.forEach=this.forEach,f.implement=this.implement,f.prototype=d,f.toString=this.toString,f.valueOf=function(a){return"object"==a?f:e.valueOf()},c.call(f,b),"function"==typeof f.init&&f.init(),f},Base.prototype={extend:function(a,b){if(arguments.length>1){var c=this[a];if(c&&"function"==typeof b&&(!c.valueOf||c.valueOf()!=b.valueOf())&&/\bbase\b/.test(b)){var d=b.valueOf();b=function(){var a=this.base||Base.prototype.base;this.base=c;var b=d.apply(this,arguments);return this.base=a,b},b.valueOf=function(a){return"object"==a?b:d},b.toString=Base.toString}this[a]=b}else if(a){var e=Base.prototype.extend;Base._prototyping||"function"==typeof this||(e=this.extend||e);for(var f={toSource:null},g=["constructor","toString","valueOf"],h=Base._prototyping?0:1;i=g[h++];)a[i]!=f[i]&&e.call(this,i,a[i]);for(var i in a)f[i]||e.call(this,i,a[i])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(a,b,c){for(var d in a)void 0===this.prototype[d]&&b.call(c,a[d],d,a)},implement:function(){for(var a=0;a<arguments.length;a++)"function"==typeof arguments[a]?arguments[a](this.prototype):this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}}),wysihtml5.browser=function(){function h(a){return+(/ipad|iphone|ipod/.test(a)&&a.match(/ os (\d+).+? like mac os x/)||[,0])[1]}function i(a){return+(a.match(/android (\d+)/)||[,0])[1]}var a=navigator.userAgent,b=document.createElement("div"),c=a.indexOf("MSIE")!==-1&&a.indexOf("Opera")===-1,d=a.indexOf("Gecko")!==-1&&a.indexOf("KHTML")===-1,e=a.indexOf("AppleWebKit/")!==-1,f=a.indexOf("Chrome/")!==-1,g=a.indexOf("Opera/")!==-1;return{USER_AGENT:a,supported:function(){var a=this.USER_AGENT.toLowerCase(),c="contentEditable"in b,d=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,e=document.querySelector&&document.querySelectorAll,f=this.isIos()&&h(a)<5||this.isAndroid()&&i(a)<4||a.indexOf("opera mobi")!==-1||a.indexOf("hpwos/")!==-1;return c&&d&&e&&!f},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return this.USER_AGENT.indexOf("Android")!==-1},supportsSandboxedIframes:function(){return c},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return c},hasCurrentStyleProperty:function(){return"currentStyle"in b},hasHistoryIssue:function(){return d},insertsLineBreaksOnReturn:function(){return d},supportsPlaceholderAttributeOn:function(a){return"placeholder"in a},supportsEvent:function(a){return"on"+a in b||function(){return b.setAttribute("on"+a,"return;"),"function"==typeof b["on"+a]}()},supportsEventsInIframeCorrectly:function(){return!g},supportsHTML5Tags:function(a){var b=a.createElement("div"),c="<article>foo</article>";return b.innerHTML=c,b.innerHTML.toLowerCase()===c},supportsCommand:function(){var a={formatBlock:c,insertUnorderedList:c||e,insertOrderedList:c||e},b={insertHTML:d};return function(c,d){var e=a[d];if(!e){try{return c.queryCommandSupported(d)}catch(a){}try{return c.queryCommandEnabled(d)}catch(a){return!!b[d]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return c},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return d||g||e},supportsGetAttributeCorrectly:function(){var a=document.createElement("td");return"1"!=a.getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return d||c||g},autoScrollsToCaret:function(){return!e},autoClosesUnclosedTags:function(){var c,d,a=b.cloneNode(!1);return a.innerHTML="<p><div></div>",d=a.innerHTML.toLowerCase(),c="<p></p><div></div>"===d||"<p><div></div></p>"===d,this.autoClosesUnclosedTags=function(){return c},c},supportsNativeGetElementsByClassName:function(){return String(document.getElementsByClassName).indexOf("[native code]")!==-1},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return g},supportsSpeechApiOn:function(b){var c=a.match(/Chrome\/(\d+)/)||[,0];return c[1]>=11&&("onwebkitspeechchange"in b||"speech"in b)},crashesWhenDefineProperty:function(a){return c&&("XMLHttpRequest"===a||"XDomainRequest"===a)},doesAsyncFocus:function(){return c},hasProblemsSettingCaretAfterImg:function(){return c},hasUndoInContextMenu:function(){return d||f||g},hasInsertNodeIssue:function(){return g},hasIframeFocusIssue:function(){return c}}}(),wysihtml5.lang.array=function(a){return{contains:function(b){if(a.indexOf)return a.indexOf(b)!==-1;for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return!0;return!1},without:function(b){b=wysihtml5.lang.array(b);for(var c=[],d=0,e=a.length;d<e;d++)b.contains(a[d])||c.push(a[d]);return c},get:function(){for(var b=0,c=a.length,d=[];b<c;b++)d.push(a[b]);return d}}},wysihtml5.lang.Dispatcher=Base.extend({on:function(a,b){return this.events=this.events||{},this.events[a]=this.events[a]||[],this.events[a].push(b),this},off:function(a,b){this.events=this.events||{};var d,e,c=0;if(a){for(d=this.events[a]||[],e=[];c<d.length;c++)d[c]!==b&&b&&e.push(d[c]);this.events[a]=e}else this.events={};return this},fire:function(a,b){this.events=this.events||{};for(var c=this.events[a]||[],d=0;d<c.length;d++)c[d].call(this,b);return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}}),wysihtml5.lang.object=function(a){return{merge:function(b){for(var c in b)a[c]=b[c];return this},get:function(){return a},clone:function(){var c,b={};for(c in a)b[c]=a[c];return b},isArray:function(){return"[object Array]"===Object.prototype.toString.call(a)}}},function(){var a=/^\s+/,b=/\s+$/;wysihtml5.lang.string=function(c){return c=String(c),{trim:function(){return c.replace(a,"").replace(b,"")},interpolate:function(a){for(var b in a)c=this.replace("#{"+b+"}").by(a[b]);return c},replace:function(a){return{by:function(b){return c.split(a).join(b)}}}}}}(),function(a){function g(a){return k(a)?a:(a===a.ownerDocument.documentElement&&(a=a.ownerDocument.body),l(a))}function h(a){return a.replace(c,function(a,b){var c=(b.match(d)||[])[1]||"",g=f[c];b=b.replace(d,""),b.split(g).length>b.split(c).length&&(b+=c,c="");var h=b,i=b;return b.length>e&&(i=i.substr(0,e)+"..."),"www."===h.substr(0,4)&&(h="http://"+h),'<a href="'+h+'">'+i+"</a>"+c})}function i(a){var b=a._wysihtml5_tempElement;return b||(b=a._wysihtml5_tempElement=a.createElement("div")),b}function j(a){var b=a.parentNode,c=i(b.ownerDocument);for(c.innerHTML="<span></span>"+h(a.data),c.removeChild(c.firstChild);c.firstChild;)b.insertBefore(c.firstChild,a);b.removeChild(a)}function k(a){for(var c;a.parentNode;){if(a=a.parentNode,c=a.nodeName,b.contains(c))return!0;if("body"===c)return!1}return!1}function l(d){if(!b.contains(d.nodeName)){if(d.nodeType===a.TEXT_NODE&&d.data.match(c))return void j(d);for(var e=a.lang.array(d.childNodes).get(),f=e.length,g=0;g<f;g++)l(e[g]);return d}}var b=a.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),c=/((https?:\/\/|www\.)[^\s<]{3,})/gi,d=/([^\w\/\-](,?))$/i,e=100,f={")":"(","]":"[","}":"{"};a.dom.autoLink=g,a.dom.autoLink.URL_REG_EXP=c}(wysihtml5),function(a){var b=a.dom;b.addClass=function(a,c){var d=a.classList;return d?d.add(c):void(b.hasClass(a,c)||(a.className+=" "+c))},b.removeClass=function(a,b){var c=a.classList;return c?c.remove(b):void(a.className=a.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," "))},b.hasClass=function(a,b){var c=a.classList;if(c)return c.contains(b);var d=a.className;return d.length>0&&(d==b||new RegExp("(^|\\s)"+b+"(\\s|$)").test(d))}}(wysihtml5),wysihtml5.dom.contains=function(){var a=document.documentElement;return a.contains?function(a,b){return b.nodeType!==wysihtml5.ELEMENT_NODE&&(b=b.parentNode),a!==b&&a.contains(b)}:a.compareDocumentPosition?function(a,b){return!!(16&a.compareDocumentPosition(b))}:void 0}(),wysihtml5.dom.convertToList=function(){function a(a,b){var c=a.createElement("li");return b.appendChild(c),c}function b(a,b){return a.createElement(b)}function c(c,d){if("UL"===c.nodeName||"OL"===c.nodeName||"MENU"===c.nodeName)return c;var i,j,k,l,m,n,o,p,q,e=c.ownerDocument,f=b(e,d),g=c.querySelectorAll("br"),h=g.length;for(q=0;q<h;q++)for(l=g[q];(m=l.parentNode)&&m!==c&&m.lastChild===l;){if("block"===wysihtml5.dom.getStyle("display").from(m)){m.removeChild(l);break}wysihtml5.dom.insert(l).after(l.parentNode)}for(i=wysihtml5.lang.array(c.childNodes).get(),j=i.length,q=0;q<j;q++)p=p||a(e,f),k=i[q],n="block"===wysihtml5.dom.getStyle("display").from(k),o="BR"===k.nodeName,n?(p=p.firstChild?a(e,f):p,p.appendChild(k),p=null):o?p=p.firstChild?null:p:p.appendChild(k);return 0===i.length&&a(e,f),c.parentNode.replaceChild(f,c),f}return c}(),wysihtml5.dom.copyAttributes=function(a){return{from:function(b){return{to:function(c){for(var d,e=0,f=a.length;e<f;e++)d=a[e],"undefined"!=typeof b[d]&&""!==b[d]&&(c[d]=b[d]);return{andTo:arguments.callee}}}}}},function(a){var b=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],c=function(b){return!!d(b)&&parseInt(a.getStyle("width").from(b),10)<b.offsetWidth},d=function(c){for(var d=0,e=b.length;d<e;d++)if("border-box"===a.getStyle(b[d]).from(c))return b[d]};a.copyStyles=function(d){return{from:function(e){c(e)&&(d=wysihtml5.lang.array(d).without(b));for(var i,f="",g=d.length,h=0;h<g;h++)i=d[h],f+=i+":"+a.getStyle(i).from(e)+";";return{to:function(b){return a.setStyles(f).on(b),{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(a){a.dom.delegate=function(b,c,d,e){return a.dom.observe(b,d,function(d){for(var f=d.target,g=a.lang.array(b.querySelectorAll(c));f&&f!==b;){if(g.contains(f)){e.call(f,d);break}f=f.parentNode}})}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var a=function(a,b){var c=b.createElement("div");c.style.display="none",b.body.appendChild(c);try{c.innerHTML=a}catch(a){}return b.body.removeChild(c),c},b=function(a){if(!a._wysihtml5_supportsHTML5Tags){for(var b=0,d=c.length;b<d;b++)a.createElement(c[b]);a._wysihtml5_supportsHTML5Tags=!0}},c=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(c,d){d=d||document;var e;return"object"==typeof c&&c.nodeType?(e=d.createElement("div"),e.appendChild(c)):wysihtml5.browser.supportsHTML5Tags(d)?(e=d.createElement("div"),e.innerHTML=c):(b(d),e=a(c,d)),e}}(),wysihtml5.dom.getParentElement=function(){function a(a,b){return!b||!b.length||("string"==typeof b?a===b:wysihtml5.lang.array(b).contains(a))}function b(a){return a.nodeType===wysihtml5.ELEMENT_NODE}function c(a,b,c){var d=(a.className||"").match(c)||[];return b?d[d.length-1]===b:!!d.length}function d(b,c,d){for(;d--&&b&&"BODY"!==b.nodeName;){if(a(b.nodeName,c))return b;b=b.parentNode}return null}function e(d,e,f,g,h){for(;h--&&d&&"BODY"!==d.nodeName;){if(b(d)&&a(d.nodeName,e)&&c(d,f,g))return d;d=d.parentNode}return null}return function(a,b,c){return c=c||50,b.className||b.classRegExp?e(a,b.nodeName,b.className,b.classRegExp,c):d(a,b.nodeName,c)}}(),wysihtml5.dom.getStyle=function(){function c(a){return a.replace(b,function(a){return a.charAt(1).toUpperCase()})}var a={float:"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},b=/\-[a-z]/g;return function(b){return{from:function(d){if(d.nodeType===wysihtml5.ELEMENT_NODE){var e=d.ownerDocument,f=a[b]||c(b),g=d.style,h=d.currentStyle,i=g[f];if(i)return i;if(h)try{return h[f]}catch(a){}var l,m,j=e.defaultView||e.parentWindow,k=("height"===b||"width"===b)&&"TEXTAREA"===d.nodeName;return j.getComputedStyle?(k&&(l=g.overflow,g.overflow="hidden"),m=j.getComputedStyle(d,null).getPropertyValue(b),k&&(g.overflow=l||""),m):void 0}}}}}(),wysihtml5.dom.hasElementWithTagName=function(){function c(a){return a._wysihtml5_identifier||(a._wysihtml5_identifier=b++)}var a={},b=1;return function(b,d){var e=c(b)+":"+d,f=a[e];return f||(f=a[e]=b.getElementsByTagName(d)),f.length>0}}(),function(a){function d(a){return a._wysihtml5_identifier||(a._wysihtml5_identifier=c++)}var b={},c=1;a.dom.hasElementWithClassName=function(c,e){if(!a.browser.supportsNativeGetElementsByClassName())return!!c.querySelector("."+e);var f=d(c)+":"+e,g=b[f];return g||(g=b[f]=c.getElementsByClassName(e)),g.length>0}}(wysihtml5),wysihtml5.dom.insert=function(a){return{after:function(b){b.parentNode.insertBefore(a,b.nextSibling)},before:function(b){b.parentNode.insertBefore(a,b)},into:function(b){b.appendChild(a)}}},wysihtml5.dom.insertCSS=function(a){return a=a.join("\n"),{into:function(b){var c=b.createElement("style");c.type="text/css",c.styleSheet?c.styleSheet.cssText=a:c.appendChild(b.createTextNode(a));var d=b.querySelector("head link");if(d)return void d.parentNode.insertBefore(c,d);var e=b.querySelector("head");e&&e.appendChild(c)}}},wysihtml5.dom.observe=function(a,b,c){b="string"==typeof b?[b]:b;for(var d,e,f=0,g=b.length;f<g;f++)e=b[f],a.addEventListener?a.addEventListener(e,c,!1):(d=function(b){"target"in b||(b.target=b.srcElement),b.preventDefault=b.preventDefault||function(){this.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){this.cancelBubble=!0},c.call(a,b)},a.attachEvent("on"+e,d));return{stop:function(){for(var e,f=0,g=b.length;f<g;f++)e=b[f],a.removeEventListener?a.removeEventListener(e,c,!1):a.detachEvent("on"+e,d)}}},wysihtml5.dom.parse=function(){function f(a,b,c,f){wysihtml5.lang.object(e).merge(d).merge(b).get(),c=c||a.ownerDocument||document;var j,k,l,h=c.createDocumentFragment(),i="string"==typeof a;for(j=i?wysihtml5.dom.getAsDom(a,c):a;j.firstChild;)l=j.firstChild,j.removeChild(l),k=g(l,f),k&&h.appendChild(k);return j.innerHTML="",j.appendChild(h),i?wysihtml5.quirks.getCorrectInnerHTML(j):j}function g(c,d){var k,l,e=c.nodeType,f=c.childNodes,h=f.length,i=a[e],j=0;if(k=i&&i(c),!k)return null;for(j=0;j<h;j++)l=g(f[j],d),l&&k.appendChild(l);return d&&k.childNodes.length<=1&&k.nodeName.toLowerCase()===b&&!k.attributes.length?k.firstChild:k}function h(a){var c,d,f=e.tags,g=a.nodeName.toLowerCase(),h=a.scopeName;if(a._wysihtml5)return null;if(a._wysihtml5=1,"wysihtml5-temp"===a.className)return null;if(h&&"HTML"!=h&&(g=h+":"+g),"outerHTML"in a&&(wysihtml5.browser.autoClosesUnclosedTags()||"P"!==a.nodeName||"</p>"===a.outerHTML.slice(-4).toLowerCase()||(g="div")),g in f){if(c=f[g],!c||c.remove)return null;c="string"==typeof c?{rename_tag:c}:c}else{if(!a.firstChild)return null;c={rename_tag:b}}return d=a.ownerDocument.createElement(c.rename_tag||g),i(a,d,c),a=null,d}function i(a,b,d){var t,u,v,w,x,y,z,f={},g=d.set_class,h=d.add_class,i=d.set_attributes,j=d.check_attributes,l=e.classes,m=0,p=[],q=[],r=[],s=[];if(i&&(f=wysihtml5.lang.object(i).clone()),j)for(x in j)z=n[j[x]],z&&(y=z(k(a,x)),"string"==typeof y&&(f[x]=y));if(g&&p.push(g),h)for(x in h)z=o[h[x]],z&&(w=z(k(a,x)),"string"==typeof w&&p.push(w));for(l["_wysihtml5-temp-placeholder"]=1,s=a.getAttribute("class"),s&&(p=p.concat(s.split(c))),t=p.length;m<t;m++)v=p[m],l[v]&&q.push(v);for(u=q.length;u--;)v=q[u],wysihtml5.lang.array(r).contains(v)||r.unshift(v);r.length&&(f.class=r.join(" "));for(x in f)try{b.setAttribute(x,f[x])}catch(a){}f.src&&("undefined"!=typeof f.width&&b.setAttribute("width",f.width),"undefined"!=typeof f.height&&b.setAttribute("height",f.height))}function k(a,b){b=b.toLowerCase();var c=a.nodeName;if("IMG"==c&&"src"==b&&l(a)===!0)return a.src;if(j&&"outerHTML"in a){var d=a.outerHTML.toLowerCase(),e=d.indexOf(" "+b+"=")!=-1;return e?a.getAttribute(b):null}return a.getAttribute(b)}function l(a){try{return a.complete&&!a.mozMatchesSelector(":-moz-broken")}catch(b){if(a.complete&&"complete"===a.readyState)return!0}}function m(a){return a.ownerDocument.createTextNode(a.data)}var a={1:h,3:m},b="span",c=/\s+/,d={tags:{},classes:{}},e={},j=!wysihtml5.browser.supportsGetAttributeCorrectly(),n={url:function(){var a=/^https?:\/\//i;return function(b){return b&&b.match(a)?b.replace(a,function(a){return a.toLowerCase()}):null}}(),src:function(){var a=/^(\/|https?:\/\/)/i;return function(b){return b&&b.match(a)?b.replace(a,function(a){return a.toLowerCase()}):null}}(),href:function(){var a=/^(\/|https?:\/\/|mailto:)/i;return function(b){return b&&b.match(a)?b.replace(a,function(a){return a.toLowerCase()}):null}}(),alt:function(){var a=/[^ a-z0-9_\-]/gi;return function(b){return b?b.replace(a,""):""}}(),numbers:function(){var a=/\D/g;return function(b){return b=(b||"").replace(a,""),b||null}}()},o={align_img:function(){var a={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(b){return a[String(b).toLowerCase()]}}(),align_text:function(){var a={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(b){return a[String(b).toLowerCase()]}}(),clear_br:function(){var a={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(b){return a[String(b).toLowerCase()]}}(),size_font:function(){var a={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(b){return a[String(b).charAt(0)]}}()};return f}(),wysihtml5.dom.removeEmptyTextNodes=function(a){for(var b,c=wysihtml5.lang.array(a.childNodes).get(),d=c.length,e=0;e<d;e++)b=c[e],b.nodeType===wysihtml5.TEXT_NODE&&""===b.data&&b.parentNode.removeChild(b)},wysihtml5.dom.renameElement=function(a,b){for(var d,c=a.ownerDocument.createElement(b);d=a.firstChild;)c.appendChild(d);return wysihtml5.dom.copyAttributes(["align","className"]).from(a).to(c),a.parentNode.replaceChild(c,a),c},wysihtml5.dom.replaceWithChildNodes=function(a){if(a.parentNode){if(!a.firstChild)return void a.parentNode.removeChild(a);for(var b=a.ownerDocument.createDocumentFragment();a.firstChild;)b.appendChild(a.firstChild);a.parentNode.replaceChild(b,a),a=b=null}},function(a){function b(b){return"block"===a.getStyle("display").from(b)}function c(a){return"BR"===a.nodeName}function d(a){var b=a.ownerDocument.createElement("br");a.appendChild(b)}function e(a,e){if(a.nodeName.match(/^(MENU|UL|OL)$/)){var i,j,k,l,m,n,f=a.ownerDocument,g=f.createDocumentFragment(),h=a.previousElementSibling||a.previousSibling;if(e)for(h&&!b(h)&&d(g);n=a.firstElementChild||a.firstChild;){for(j=n.lastChild;i=n.firstChild;)k=i===j,l=k&&!b(i)&&!c(i),g.appendChild(i),l&&d(g);n.parentNode.removeChild(n)}else for(;n=a.firstElementChild||a.firstChild;){if(n.querySelector&&n.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))for(;i=n.firstChild;)g.appendChild(i);else{for(m=f.createElement("p");i=n.firstChild;)m.appendChild(i);g.appendChild(m)}n.parentNode.removeChild(n)}a.parentNode.replaceChild(g,a)}}a.resolveList=e}(wysihtml5.dom),function(a){var b=document,c=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],d=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],e=["referrer","write","open","close"];a.dom.Sandbox=Base.extend({constructor:function(b,c){this.callback=b||a.EMPTY_FUNCTION,this.config=a.lang.object({}).merge(c).get(),this.iframe=this._createIframe()},insertInto:function(a){"string"==typeof a&&(a=b.getElementById(a)),a.appendChild(this.iframe)},getIframe:function(){return this.iframe},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var a=this.getIframe();a.parentNode.removeChild(a)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var c=this,d=b.createElement("iframe");return d.className="wysihtml5-sandbox",a.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(d),a.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(d.src="javascript:'<html></html>'"),d.onload=function(){d.onreadystatechange=d.onload=null,c._onLoadIframe(d)},d.onreadystatechange=function(){/loaded|complete/.test(d.readyState)&&(d.onreadystatechange=d.onload=null,c._onLoadIframe(d))},d},_onLoadIframe:function(f){if(a.dom.contains(b.documentElement,f)){var g=this,h=f.contentWindow,i=f.contentWindow.document,j=b.characterSet||b.charset||"utf-8",k=this._getHtml({charset:j,stylesheets:this.config.stylesheets});if(i.open("text/html","replace"),i.write(k),i.close(),this.getWindow=function(){return f.contentWindow},this.getDocument=function(){return f.contentWindow.document},h.onerror=function(a,b,c){throw new Error("wysihtml5.Sandbox: "+a,b,c)},!a.browser.supportsSandboxedIframes()){var l,m;for(l=0,m=c.length;l<m;l++)this._unset(h,c[l]);for(l=0,m=d.length;l<m;l++)this._unset(h,d[l],a.EMPTY_FUNCTION);for(l=0,m=e.length;l<m;l++)this._unset(i,e[l]);this._unset(i,"cookie","",!0)}this.loaded=!0,setTimeout(function(){g.callback(g)},0)}},_getHtml:function(b){var f,c=b.stylesheets,d="",e=0;if(c="string"==typeof c?[c]:c)for(f=c.length;e<f;e++)d+='<link rel="stylesheet" href="'+c[e]+'">';return b.stylesheets=d,a.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(b);
},_unset:function(b,c,d,e){try{b[c]=d}catch(a){}try{b.__defineGetter__(c,function(){return d})}catch(a){}if(e)try{b.__defineSetter__(c,function(){})}catch(a){}if(!a.browser.crashesWhenDefineProperty(c))try{var f={get:function(){return d}};e&&(f.set=function(){}),Object.defineProperty(b,c,f)}catch(a){}}})}(wysihtml5),function(){var a={className:"class"};wysihtml5.dom.setAttributes=function(b){return{on:function(c){for(var d in b)c.setAttribute(a[d]||d,b[d])}}}}(),wysihtml5.dom.setStyles=function(a){return{on:function(b){var c=b.style;if("string"==typeof a)return void(c.cssText+=";"+a);for(var d in a)"float"===d?(c.cssFloat=a[d],c.styleFloat=a[d]):c[d]=a[d]}}},function(a){a.simulatePlaceholder=function(b,c,d){var e="placeholder",f=function(){c.hasPlaceholderSet()&&c.clear(),c.placeholderSet=!1,a.removeClass(c.element,e)},g=function(){c.isEmpty()&&(c.placeholderSet=!0,c.setValue(d),a.addClass(c.element,e))};b.on("set_placeholder",g).on("unset_placeholder",f).on("focus:composer",f).on("paste:composer",f).on("blur:composer",g),g()}}(wysihtml5.dom),function(a){var b=document.documentElement;"textContent"in b?(a.setTextContent=function(a,b){a.textContent=b},a.getTextContent=function(a){return a.textContent}):"innerText"in b?(a.setTextContent=function(a,b){a.innerText=b},a.getTextContent=function(a){return a.innerText}):(a.setTextContent=function(a,b){a.nodeValue=b},a.getTextContent=function(a){return a.nodeValue})}(wysihtml5.dom),wysihtml5.quirks.cleanPastedHTML=function(){function b(b,c,d){c=c||a,d=d||b.ownerDocument||document;var e,g,h,i,j,f="string"==typeof b,k=0;e=f?wysihtml5.dom.getAsDom(b,d):b;for(j in c)for(h=e.querySelectorAll(j),g=c[j],i=h.length;k<i;k++)g(h[k]);return h=b=c=null,f?e.innerHTML:e}var a={"a u":wysihtml5.dom.replaceWithChildNodes};return b}(),wysihtml5.quirks.ensureProperClearing=function(){var a=function(){var a=this;setTimeout(function(){var b=a.innerHTML.toLowerCase();"<p>&nbsp;</p>"!=b&&"<p>&nbsp;</p><p>&nbsp;</p>"!=b||(a.innerHTML="")},0)};return function(b){wysihtml5.dom.observe(b.element,["cut","keydown"],a)}}(),function(a){var b="%7E";a.quirks.getCorrectInnerHTML=function(c){var d=c.innerHTML;if(d.indexOf(b)===-1)return d;var f,g,h,i,e=c.querySelectorAll("[href*='~'], [src*='~']");for(i=0,h=e.length;i<h;i++)f=e[i].href||e[i].src,g=a.lang.string(f).replace("~").by(b),d=a.lang.string(d).replace(g).by(f);return d}}(wysihtml5),function(a){var b="wysihtml5-quirks-redraw";a.quirks.redraw=function(c){a.dom.addClass(c,b),a.dom.removeClass(c,b);try{var d=c.ownerDocument;d.execCommand("italic",!1,null),d.execCommand("italic",!1,null)}catch(a){}}}(wysihtml5),function(a){function c(a){var b=0;if(a.parentNode)do b+=a.offsetTop||0,a=a.offsetParent;while(a);return b}var b=a.dom;a.Selection=Base.extend({constructor:function(a){window.rangy.init(),this.editor=a,this.composer=a.composer,this.doc=this.composer.doc},getBookmark:function(){var a=this.getRange();return a&&a.cloneRange()},setBookmark:function(a){a&&this.setSelection(a)},setBefore:function(a){var b=rangy.createRange(this.doc);return b.setStartBefore(a),b.setEndBefore(a),this.setSelection(b)},setAfter:function(a){var b=rangy.createRange(this.doc);return b.setStartAfter(a),b.setEndAfter(a),this.setSelection(b)},selectNode:function(c,d){var e=rangy.createRange(this.doc),f=c.nodeType===a.ELEMENT_NODE,g="canHaveHTML"in c?c.canHaveHTML:"IMG"!==c.nodeName,h=f?c.innerHTML:c.data,i=""===h||h===a.INVISIBLE_SPACE,j=b.getStyle("display").from(c),k="block"===j||"list-item"===j;if(i&&f&&g&&!d)try{c.innerHTML=a.INVISIBLE_SPACE}catch(a){}g?e.selectNodeContents(c):e.selectNode(c),g&&i&&f?e.collapse(k):g&&i&&(e.setStartAfter(c),e.setEndAfter(c)),this.setSelection(e)},getSelectedNode:function(a){var b,c;return a&&this.doc.selection&&"Control"===this.doc.selection.type&&(c=this.doc.selection.createRange(),c&&c.length)?c.item(0):(b=this.getSelection(this.doc),b.focusNode===b.anchorNode?b.focusNode:(c=this.getRange(this.doc),c?c.commonAncestorContainer:this.doc.body))},executeAndRestore:function(c,d){var k,l,m,n,o,e=this.doc.body,f=d&&e.scrollTop,g=d&&e.scrollLeft,h="_wysihtml5-temp-placeholder",i='<span class="'+h+'">'+a.INVISIBLE_SPACE+"</span>",j=this.getRange(this.doc);if(!j)return void c(e,e);a.browser.hasInsertNodeIssue()?this.doc.execCommand("insertHTML",!1,i):(n=j.createContextualFragment(i),j.insertNode(n));try{c(j.startContainer,j.endContainer)}catch(a){setTimeout(function(){throw a},0)}k=this.doc.querySelector("."+h),k?(o=rangy.createRange(this.doc),m=k.nextSibling,a.browser.hasInsertNodeIssue()&&m&&"BR"===m.nodeName?(l=this.doc.createTextNode(a.INVISIBLE_SPACE),b.insert(l).after(k),o.setStartBefore(l),o.setEndBefore(l)):(o.selectNode(k),o.deleteContents()),this.setSelection(o)):e.focus(),d&&(e.scrollTop=f,e.scrollLeft=g);try{k.parentNode.removeChild(k)}catch(a){}},executeAndRestoreSimple:function(a){var d,e,f,g,h,b=this.getRange(),c=this.doc.body;if(!b)return void a(c,c);g=b.getNodes([3]),e=g[0]||b.startContainer,f=g[g.length-1]||b.endContainer,h={collapsed:b.collapsed,startContainer:e,startOffset:e===b.startContainer?b.startOffset:0,endContainer:f,endOffset:f===b.endContainer?b.endOffset:f.length};try{a(b.startContainer,b.endContainer)}catch(a){setTimeout(function(){throw a},0)}d=rangy.createRange(this.doc);try{d.setStart(h.startContainer,h.startOffset)}catch(a){}try{d.setEnd(h.endContainer,h.endOffset)}catch(a){}try{this.setSelection(d)}catch(a){}},set:function(a,b){var c=rangy.createRange(this.doc);c.setStart(a,b||0),this.setSelection(c)},insertHTML:function(a){var b=rangy.createRange(this.doc),c=b.createContextualFragment(a),d=c.lastChild;this.insertNode(c),d&&this.setAfter(d)},insertNode:function(a){var b=this.getRange();b&&b.insertNode(a)},surround:function(a){var b=this.getRange();if(b)try{b.surroundContents(a),this.selectNode(a)}catch(c){a.appendChild(b.extractContents()),b.insertNode(a)}},scrollIntoView:function(){var g,b=this.doc,d=5,e=b.documentElement.scrollHeight>b.documentElement.offsetHeight,f=b._wysihtml5ScrollIntoViewElement=b._wysihtml5ScrollIntoViewElement||function(){var c=b.createElement("span");return c.innerHTML=a.INVISIBLE_SPACE,c}();e&&(this.insertNode(f),g=c(f),f.parentNode.removeChild(f),g>=b.body.scrollTop+b.documentElement.offsetHeight-d&&(b.body.scrollTop=g))},selectLine:function(){a.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var a=this.doc.defaultView,b=a.getSelection();b.modify("extend","left","lineboundary"),b.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var d,e,f,g,h,a=this.doc.selection.createRange(),b=a.boundingTop,c=this.doc.body.scrollWidth;if(a.moveToPoint){for(0===b&&(f=this.doc.createElement("span"),this.insertNode(f),b=f.offsetTop,f.parentNode.removeChild(f)),b+=1,g=-10;g<c;g+=2)try{a.moveToPoint(g,b);break}catch(a){}for(d=b,e=this.doc.selection.createRange(),h=c;h>=0;h--)try{e.moveToPoint(h,d);break}catch(a){}a.setEndPoint("EndToEnd",e),a.select()}},getText:function(){var a=this.getSelection();return a?a.toString():""},getNodes:function(a,b){var c=this.getRange();return c?c.getNodes([a],b):[]},getRange:function(){var a=this.getSelection();return a&&a.rangeCount&&a.getRangeAt(0)},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(a){var b=this.doc.defaultView||this.doc.parentWindow,c=rangy.getSelection(b);return c.setSingleRange(a)}})}(wysihtml5),function(a,b){function e(a,b,c){if(!a.className)return!1;var d=a.className.match(c)||[];return d[d.length-1]===b}function f(a,b,c){a.className?(g(a,c),a.className+=" "+b):a.className=b}function g(a,b){a.className&&(a.className=a.className.replace(b,""))}function h(a,b){return a.className.replace(d," ")==b.className.replace(d," ")}function i(a){for(var b=a.parentNode;a.firstChild;)b.insertBefore(a.firstChild,a);b.removeChild(a)}function j(a,b){if(a.attributes.length!=b.attributes.length)return!1;for(var e,f,g,c=0,d=a.attributes.length;c<d;++c)if(e=a.attributes[c],g=e.name,"class"!=g){if(f=b.attributes.getNamedItem(g),e.specified!=f.specified)return!1;if(e.specified&&e.nodeValue!==f.nodeValue)return!1}return!0}function k(a,c){return b.dom.isCharacterDataNode(a)?0==c?!!a.previousSibling:c!=a.length||!!a.nextSibling:c>0&&c<a.childNodes.length}function l(a,c,d){var e;if(b.dom.isCharacterDataNode(c)&&(0==d?(d=b.dom.getNodeIndex(c),c=c.parentNode):d==c.length?(d=b.dom.getNodeIndex(c)+1,c=c.parentNode):e=b.dom.splitDataNode(c,d)),!e){e=c.cloneNode(!1),e.id&&e.removeAttribute("id");for(var f;f=c.childNodes[d];)e.appendChild(f);b.dom.insertAfter(e,c)}return c==a?e:l(a,e.parentNode,b.dom.getNodeIndex(e))}function m(b){this.isElementMerge=b.nodeType==a.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?b.lastChild:b,this.textNodes=[this.firstTextNode]}function n(a,b,d,e){this.tagNames=a||[c],this.cssClass=b||"",this.similarClassRegExp=d,this.normalize=e,this.applyToAnyTagName=!1}var c="span",d=/\s+/g;m.prototype={doMerge:function(){for(var b,c,d,a=[],e=0,f=this.textNodes.length;e<f;++e)b=this.textNodes[e],c=b.parentNode,a[e]=b.data,e&&(c.removeChild(b),c.hasChildNodes()||c.parentNode.removeChild(c));return this.firstTextNode.data=d=a.join(""),d},getLength:function(){for(var a=this.textNodes.length,b=0;a--;)b+=this.textNodes[a].length;return b},toString:function(){for(var a=[],b=0,c=this.textNodes.length;b<c;++b)a[b]="'"+this.textNodes[b].data+"'";return"[Merge("+a.join(",")+")]"}},n.prototype={getAncestorWithClass:function(c){for(var d;c;){if(d=!this.cssClass||e(c,this.cssClass,this.similarClassRegExp),c.nodeType==a.ELEMENT_NODE&&b.dom.arrayContains(this.tagNames,c.tagName.toLowerCase())&&d)return c;c=c.parentNode}return!1},postApply:function(a,b){for(var f,k,l,c=a[0],d=a[a.length-1],e=[],g=c,h=d,i=0,j=d.length,n=0,o=a.length;n<o;++n)k=a[n],l=this.getAdjacentMergeableTextNode(k.parentNode,!1),l?(f||(f=new m(l),e.push(f)),f.textNodes.push(k),k===c&&(g=f.firstTextNode,i=g.length),k===d&&(h=f.firstTextNode,j=f.getLength())):f=null;var p=this.getAdjacentMergeableTextNode(d.parentNode,!0);if(p&&(f||(f=new m(d),e.push(f)),f.textNodes.push(p)),e.length){for(n=0,o=e.length;n<o;++n)e[n].doMerge();b.setStart(g,i),b.setEnd(h,j)}},getAdjacentMergeableTextNode:function(b,c){var f,d=b.nodeType==a.TEXT_NODE,e=d?b.parentNode:b,g=c?"nextSibling":"previousSibling";if(d){if(f=b[g],f&&f.nodeType==a.TEXT_NODE)return f}else if(f=e[g],f&&this.areElementsMergeable(b,f))return f[c?"firstChild":"lastChild"];return null},areElementsMergeable:function(a,c){return b.dom.arrayContains(this.tagNames,(a.tagName||"").toLowerCase())&&b.dom.arrayContains(this.tagNames,(c.tagName||"").toLowerCase())&&h(a,c)&&j(a,c)},createContainer:function(a){var b=a.createElement(this.tagNames[0]);return this.cssClass&&(b.className=this.cssClass),b},applyToTextNode:function(a){var c=a.parentNode;if(1==c.childNodes.length&&b.dom.arrayContains(this.tagNames,c.tagName.toLowerCase()))this.cssClass&&f(c,this.cssClass,this.similarClassRegExp);else{var d=this.createContainer(b.dom.getDocument(a));a.parentNode.insertBefore(d,a),d.appendChild(a)}},isRemovable:function(c){return b.dom.arrayContains(this.tagNames,c.tagName.toLowerCase())&&a.lang.string(c.className).trim()==this.cssClass},undoToTextNode:function(a,b,c){if(!b.containsNode(c)){var d=b.cloneRange();d.selectNode(c),d.isPointInRange(b.endContainer,b.endOffset)&&k(b.endContainer,b.endOffset)&&(l(c,b.endContainer,b.endOffset),b.setEndAfter(c)),d.isPointInRange(b.startContainer,b.startOffset)&&k(b.startContainer,b.startOffset)&&(c=l(c,b.startContainer,b.startOffset))}this.similarClassRegExp&&g(c,this.similarClassRegExp),this.isRemovable(c)&&i(c)},applyToRange:function(b){var c=b.getNodes([a.TEXT_NODE]);if(!c.length)try{var d=this.createContainer(b.endContainer.ownerDocument);return b.surroundContents(d),void this.selectNode(b,d)}catch(a){}if(b.splitBoundaries(),c=b.getNodes([a.TEXT_NODE]),c.length){for(var e,f=0,g=c.length;f<g;++f)e=c[f],this.getAncestorWithClass(e)||this.applyToTextNode(e);b.setStart(c[0],0),e=c[c.length-1],b.setEnd(e,e.length),this.normalize&&this.postApply(c,b)}},undoToRange:function(b){var d,e,c=b.getNodes([a.TEXT_NODE]);if(c.length)b.splitBoundaries(),c=b.getNodes([a.TEXT_NODE]);else{var f=b.endContainer.ownerDocument,g=f.createTextNode(a.INVISIBLE_SPACE);b.insertNode(g),b.selectNode(g),c=[g]}for(var h=0,i=c.length;h<i;++h)d=c[h],e=this.getAncestorWithClass(d),e&&this.undoToTextNode(d,b,e);1==i?this.selectNode(b,c[0]):(b.setStart(c[0],0),d=c[c.length-1],b.setEnd(d,d.length),this.normalize&&this.postApply(c,b))},selectNode:function(b,c){var d=c.nodeType===a.ELEMENT_NODE,e=!("canHaveHTML"in c)||c.canHaveHTML,f=d?c.innerHTML:c.data,g=""===f||f===a.INVISIBLE_SPACE;if(g&&d&&e)try{c.innerHTML=a.INVISIBLE_SPACE}catch(a){}b.selectNodeContents(c),g&&d?b.collapse(!1):g&&(b.setStartAfter(c),b.setEndAfter(c))},getTextSelectedByRange:function(a,b){var c=b.cloneRange();c.selectNodeContents(a);var d=c.intersection(b),e=d?d.toString():"";return c.detach(),e},isAppliedToRange:function(b){var d,c=[],e=b.getNodes([a.TEXT_NODE]);if(!e.length)return d=this.getAncestorWithClass(b.startContainer),!!d&&[d];for(var h,f=0,g=e.length;f<g;++f){if(h=this.getTextSelectedByRange(e[f],b),d=this.getAncestorWithClass(e[f]),""!=h&&!d)return!1;c.push(d)}return c},toggleRange:function(a){this.isAppliedToRange(a)?this.undoToRange(a):this.applyToRange(a)}},a.selection.HTMLApplier=n}(wysihtml5,rangy),wysihtml5.Commands=Base.extend({constructor:function(a){this.editor=a,this.composer=a.composer,this.doc=this.composer.doc},support:function(a){return wysihtml5.browser.supportsCommand(this.doc,a)},exec:function(a,b){var c=wysihtml5.commands[a],d=wysihtml5.lang.array(arguments).get(),e=c&&c.exec,f=null;if(this.editor.fire("beforecommand:composer"),e)d.unshift(this.composer),f=e.apply(c,d);else try{f=this.doc.execCommand(a,!1,b)}catch(a){}return this.editor.fire("aftercommand:composer"),f},state:function(a,b){var c=wysihtml5.commands[a],d=wysihtml5.lang.array(arguments).get(),e=c&&c.state;if(e)return d.unshift(this.composer),e.apply(c,d);try{return this.doc.queryCommandState(a)}catch(a){return!1}}}),wysihtml5.commands.bold={exec:function(a,b){return wysihtml5.commands.formatInline.exec(a,b,"b")},state:function(a,b){return wysihtml5.commands.formatInline.state(a,b,"b")}},function(a){function e(a,b){for(var f,g,h,c=b.length,e=0;e<c;e++)f=b[e],g=d.getParentElement(f,{nodeName:"code"}),h=d.getTextContent(f),h.match(d.autoLink.URL_REG_EXP)&&!g?g=d.renameElement(f,"code"):d.replaceWithChildNodes(f)}function f(e,f){var k,l,m,n,o,p,q,r,s,g=e.doc,h="_wysihtml5-temp-"+ +new Date,i=/non-matching-class/g,j=0;for(a.commands.formatInline.exec(e,b,c,h,i),l=g.querySelectorAll(c+"."+h),k=l.length;j<k;j++){m=l[j],m.removeAttribute("class");for(s in f)m.setAttribute(s,f[s])}p=m,1===k&&(q=d.getTextContent(m),n=!!m.querySelector("*"),o=""===q||q===a.INVISIBLE_SPACE,!n&&o&&(d.setTextContent(m,f.text||m.href),r=g.createTextNode(" "),e.selection.setAfter(m),d.insert(r).after(m),p=r)),e.selection.setAfter(p)}var b,c="A",d=a.dom;a.commands.createLink={exec:function(a,b,c){var d=this.state(a,b);d?a.selection.executeAndRestore(function(){e(a,d)}):(c="object"==typeof c?c:{href:c},f(a,c))},state:function(b,c){return a.commands.formatInline.state(b,c,"A")}}}(wysihtml5),function(a){var b,c=/wysiwyg-font-size-[0-9a-z\-]+/g;a.commands.fontSize={exec:function(b,d,e){return a.commands.formatInline.exec(b,d,"span","wysiwyg-font-size-"+e,c)},state:function(b,d,e){return a.commands.formatInline.state(b,d,"span","wysiwyg-font-size-"+e,c)},value:function(){return b}}}(wysihtml5),function(a){var b=/wysiwyg-color-[0-9a-z]+/g;a.commands.foreColor={exec:function(c,d,e){return a.commands.formatInline.exec(c,d,"span","wysiwyg-color-"+e,b)},state:function(c,d,e){return a.commands.formatInline.state(c,d,"span","wysiwyg-color-"+e,b)}}}(wysihtml5),function(a){function d(a,b,c){a.className?(e(a,c),a.className+=" "+b):a.className=b}function e(a,b){a.className=a.className.replace(b,"")}function f(b){return b.nodeType===a.TEXT_NODE&&!a.lang.string(b.data).trim()}function g(a){for(var b=a.previousSibling;b&&f(b);)b=b.previousSibling;return b}function h(a){for(var b=a.nextSibling;b&&f(b);)b=b.nextSibling;return b}function i(a){var b=a.ownerDocument,c=h(a),d=g(a);c&&!m(c)&&a.parentNode.insertBefore(b.createElement("br"),c),d&&!m(d)&&a.parentNode.insertBefore(b.createElement("br"),a)}function j(a){var b=h(a),c=g(a);b&&l(b)&&b.parentNode.removeChild(b),c&&l(c)&&c.parentNode.removeChild(c)}function k(a){var b=a.lastChild;b&&l(b)&&b.parentNode.removeChild(b)}function l(a){return"BR"===a.nodeName}function m(a){return!!l(a)||"block"===b.getStyle("display").from(a)}function n(c,d,e,f){if(f)var g=b.observe(c,"DOMNodeInserted",function(c){var e,d=c.target;d.nodeType===a.ELEMENT_NODE&&(e=b.getStyle("display").from(d),"inline"!==e.substr(0,6)&&(d.className+=" "+f))});c.execCommand(d,!1,e),g&&g.stop()}function o(b,c){b.selection.selectLine(),b.selection.surround(c),j(c),k(c),b.selection.selectNode(c,a.browser.displaysCaretInEmptyContentEditableCorrectly())}function p(b){return!!a.lang.string(b.className).trim()}var b=a.dom,c=["H1","H2","H3","H4","H5","H6","P","BLOCKQUOTE","DIV"];a.commands.formatBlock={exec:function(f,g,h,j,k){var s,l=f.doc,m=this.state(f,g,h,j,k),q=f.config.useLineBreaks,r=q?"DIV":"P";return h="string"==typeof h?h.toUpperCase():h,m?void f.selection.executeAndRestoreSimple(function(){k&&e(m,k);var a=p(m);a||!q&&"P"!==h?b.renameElement(m,"P"===h?"DIV":r):(i(m),b.replaceWithChildNodes(m))}):(null===h||a.lang.array(c).contains(h))&&(s=f.selection.getSelectedNode(),m=b.getParentElement(s,{nodeName:c}))?void f.selection.executeAndRestore(function(){h&&(m=b.renameElement(m,h)),j&&d(m,j,k)}):f.commands.support(g)?void n(l,g,h||r,j):(m=l.createElement(h||r),j&&(m.className=j),void o(f,m))},state:function(a,c,d,e,f){d="string"==typeof d?d.toUpperCase():d;var g=a.selection.getSelectedNode();return b.getParentElement(g,{nodeName:d,className:e,classRegExp:f})}}}(wysihtml5),function(a){function d(a){var c=b[a];return c?[a.toLowerCase(),c.toLowerCase()]:[a.toLowerCase()]}function e(b,e,f){var g=b+":"+e;return c[g]||(c[g]=new a.selection.HTMLApplier(d(b),e,f,!0)),c[g]}var b={strong:"b",em:"i",b:"strong",i:"em"},c={};a.commands.formatInline={exec:function(a,b,c,d,f){var g=a.selection.getRange();return!!g&&(e(c,d,f).toggleRange(g),void a.selection.setSelection(g))},state:function(c,d,f,g,h){var k,i=c.doc,j=b[f]||f;return!(!a.dom.hasElementWithTagName(i,f)&&!a.dom.hasElementWithTagName(i,j))&&(!(g&&!a.dom.hasElementWithClassName(i,g))&&(k=c.selection.getRange(),!!k&&e(f,g,h).isAppliedToRange(k)))}}}(wysihtml5),wysihtml5.commands.insertHTML={exec:function(a,b,c){a.commands.support(b)?a.doc.execCommand(b,!1,c):a.selection.insertHTML(c)},state:function(){return!1}},function(a){var b="IMG";a.commands.insertImage={exec:function(c,d,e){e="object"==typeof e?e:{src:e};var h,i,j,f=c.doc,g=this.state(c);if(g)return c.selection.setBefore(g),j=g.parentNode,j.removeChild(g),a.dom.removeEmptyTextNodes(j),"A"!==j.nodeName||j.firstChild||(c.selection.setAfter(j),j.parentNode.removeChild(j)),void a.quirks.redraw(c.element);g=f.createElement(b);for(i in e)"className"===i&&(i="class"),g.setAttribute(i,e[i]);c.selection.insertNode(g),a.browser.hasProblemsSettingCaretAfterImg()?(h=f.createTextNode(a.INVISIBLE_SPACE),c.selection.insertNode(h),c.selection.setAfter(h)):c.selection.setAfter(g)},state:function(c){var e,f,g,d=c.doc;return!!a.dom.hasElementWithTagName(d,b)&&(!!(e=c.selection.getSelectedNode())&&(e.nodeName===b?e:e.nodeType===a.ELEMENT_NODE&&(f=c.selection.getText(),!(f=a.lang.string(f).trim())&&(g=c.selection.getNodes(a.ELEMENT_NODE,function(a){return"IMG"===a.nodeName}),1===g.length&&g[0]))))}}}(wysihtml5),function(a){var b="<br>"+(a.browser.needsSpaceAfterLineBreak()?" ":"");a.commands.insertLineBreak={exec:function(c,d){c.commands.support(d)?(c.doc.execCommand(d,!1,null),a.browser.autoScrollsToCaret()||c.selection.scrollIntoView()):c.commands.exec("insertHTML",b)},state:function(){return!1}}}(wysihtml5),wysihtml5.commands.insertOrderedList={exec:function(a,b){var h,i,c=a.doc,d=a.selection.getSelectedNode(),e=wysihtml5.dom.getParentElement(d,{nodeName:"OL"}),f=wysihtml5.dom.getParentElement(d,{nodeName:"UL"}),g="_wysihtml5-temp-"+(new Date).getTime();return e||f||!a.commands.support(b)?void(e?a.selection.executeAndRestore(function(){wysihtml5.dom.resolveList(e,a.config.useLineBreaks)}):f?a.selection.executeAndRestore(function(){wysihtml5.dom.renameElement(f,"ol")}):(a.commands.exec("formatBlock","div",g),i=c.querySelector("."+g),h=""===i.innerHTML||i.innerHTML===wysihtml5.INVISIBLE_SPACE||"<br>"===i.innerHTML,a.selection.executeAndRestore(function(){e=wysihtml5.dom.convertToList(i,"ol")}),h&&a.selection.selectNode(e.querySelector("li"),!0))):void c.execCommand(b,!1,null)},state:function(a){var b=a.selection.getSelectedNode();return wysihtml5.dom.getParentElement(b,{nodeName:"OL"})}},wysihtml5.commands.insertUnorderedList={exec:function(a,b){var h,i,c=a.doc,d=a.selection.getSelectedNode(),e=wysihtml5.dom.getParentElement(d,{nodeName:"UL"}),f=wysihtml5.dom.getParentElement(d,{nodeName:"OL"}),g="_wysihtml5-temp-"+(new Date).getTime();return e||f||!a.commands.support(b)?void(e?a.selection.executeAndRestore(function(){wysihtml5.dom.resolveList(e,a.config.useLineBreaks)}):f?a.selection.executeAndRestore(function(){wysihtml5.dom.renameElement(f,"ul")}):(a.commands.exec("formatBlock","div",g),i=c.querySelector("."+g),h=""===i.innerHTML||i.innerHTML===wysihtml5.INVISIBLE_SPACE||"<br>"===i.innerHTML,a.selection.executeAndRestore(function(){e=wysihtml5.dom.convertToList(i,"ul")}),h&&a.selection.selectNode(e.querySelector("li"),!0))):void c.execCommand(b,!1,null)},state:function(a){var b=a.selection.getSelectedNode();return wysihtml5.dom.getParentElement(b,{nodeName:"UL"})}},wysihtml5.commands.italic={exec:function(a,b){return wysihtml5.commands.formatInline.exec(a,b,"i")},state:function(a,b){return wysihtml5.commands.formatInline.state(a,b,"i")}},function(a){var b="wysiwyg-text-align-center",c=/wysiwyg-text-align-[0-9a-z]+/g;a.commands.justifyCenter={exec:function(d,e){return a.commands.formatBlock.exec(d,"formatBlock",null,b,c)},state:function(d,e){return a.commands.formatBlock.state(d,"formatBlock",null,b,c)}}}(wysihtml5),function(a){var b="wysiwyg-text-align-left",c=/wysiwyg-text-align-[0-9a-z]+/g;a.commands.justifyLeft={exec:function(d,e){return a.commands.formatBlock.exec(d,"formatBlock",null,b,c)},state:function(d,e){return a.commands.formatBlock.state(d,"formatBlock",null,b,c)}}}(wysihtml5),function(a){var b="wysiwyg-text-align-right",c=/wysiwyg-text-align-[0-9a-z]+/g;a.commands.justifyRight={exec:function(d,e){return a.commands.formatBlock.exec(d,"formatBlock",null,b,c)},state:function(d,e){return a.commands.formatBlock.state(d,"formatBlock",null,b,c)}}}(wysihtml5),function(a){var b="wysiwyg-text-align-justify",c=/wysiwyg-text-align-[0-9a-z]+/g;a.commands.justifyFull={exec:function(d,e){return a.commands.formatBlock.exec(d,"formatBlock",null,b,c)},state:function(d,e){return a.commands.formatBlock.state(d,"formatBlock",null,b,c)}}}(wysihtml5),wysihtml5.commands.redo={exec:function(a){return a.undoManager.redo()},state:function(a){return!1}},wysihtml5.commands.underline={exec:function(a,b){return wysihtml5.commands.formatInline.exec(a,b,"u")},state:function(a,b){return wysihtml5.commands.formatInline.state(a,b,"u")}},wysihtml5.commands.undo={exec:function(a){return a.undoManager.undo()},state:function(a){return!1}},function(a){function l(a){for(var b;b=a.querySelector("._wysihtml5-temp");)b.parentNode.removeChild(b)}var b=90,c=89,d=8,e=46,f=25,g="data-wysihtml5-selection-node",h="data-wysihtml5-selection-offset",i='<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+a.INVISIBLE_SPACE+"</span>",j='<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+a.INVISIBLE_SPACE+"</span>",k=a.dom;a.UndoManager=a.lang.Dispatcher.extend({constructor:function(a){this.editor=a,this.composer=a.composer,this.element=this.composer.element,this.position=0,this.historyStr=[],this.historyDom=[],this.transact(),this._observe()},_observe:function(){var h,f=this,g=this.composer.sandbox.getDocument();if(k.observe(this.element,"keydown",function(a){if(!a.altKey&&(a.ctrlKey||a.metaKey)){var d=a.keyCode,e=d===b&&!a.shiftKey,g=d===b&&a.shiftKey||d===c;e?(f.undo(),a.preventDefault()):g&&(f.redo(),a.preventDefault())}}),k.observe(this.element,"keydown",function(a){var b=a.keyCode;b!==h&&(h=b,b!==d&&b!==e||f.transact())}),a.browser.hasUndoInContextMenu()){var m,n,o=function(){l(g),clearInterval(m)};k.observe(this.element,"contextmenu",function(){o(),f.composer.selection.executeAndRestoreSimple(function(){f.element.lastChild&&f.composer.selection.setAfter(f.element.lastChild),g.execCommand("insertHTML",!1,i),g.execCommand("insertHTML",!1,j),g.execCommand("undo",!1,null)}),m=setInterval(function(){g.getElementById("_wysihtml5-redo")?(o(),f.redo()):g.getElementById("_wysihtml5-undo")||(o(),f.undo())},400),n||(n=!0,k.observe(document,"mousedown",o),k.observe(g,["mousedown","paste","cut","copy"],o))})}this.editor.on("newword:composer",function(){f.transact()}).on("beforecommand:composer",function(){f.transact()})},transact:function(){var b=this.historyStr[this.position-1],c=this.composer.getValue();if(c!==b){var d=this.historyStr.length=this.historyDom.length=this.position;d>f&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++;var k,l,e=this.composer.selection.getRange(),i=e.startContainer||this.element,j=e.startOffset||0;i.nodeType===a.ELEMENT_NODE?k=i:(k=i.parentNode,l=this.getChildNodeIndex(k,i)),k.setAttribute(h,j),"undefined"!=typeof l&&k.setAttribute(g,l);var m=this.element.cloneNode(!!c);this.historyDom.push(m),this.historyStr.push(c),k.removeAttribute(h),k.removeAttribute(g)}},undo:function(){this.transact(),this.undoPossible()&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return this.position>1},redoPossible:function(){return this.position<this.historyStr.length},set:function(a){this.element.innerHTML="";for(var b=0,c=a.childNodes,d=a.childNodes.length;b<d;b++)this.element.appendChild(c[b].cloneNode(!0));var e,f,i;a.hasAttribute(h)?(e=a.getAttribute(h),i=a.getAttribute(g),f=this.element):(f=this.element.querySelector("["+h+"]")||this.element,e=f.getAttribute(h),i=f.getAttribute(g),f.removeAttribute(h),f.removeAttribute(g)),null!==i&&(f=this.getChildNodeByIndex(f,+i)),this.composer.selection.set(f,e)},getChildNodeIndex:function(a,b){for(var c=0,d=a.childNodes,e=d.length;c<e;c++)if(d[c]===b)return c},getChildNodeByIndex:function(a,b){return a.childNodes[b]}})}(wysihtml5),wysihtml5.views.View=Base.extend({constructor:function(a,b,c){this.parent=a,this.element=b,this.config=c,this._observeViewChange()},_observeViewChange:function(){var a=this;this.parent.on("beforeload",function(){a.parent.on("change_view",function(b){b===a.name?(a.parent.currentView=a,a.show(),setTimeout(function(){a.focus()},0)):a.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(a){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(a){var b=a.dom,c=a.browser;a.views.Composer=a.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(a,b,c){this.base(a,b,c),this.textarea=this.parent.textarea,this._initSandbox()},clear:function(){this.element.innerHTML=c.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(b){var c=this.isEmpty()?"":a.quirks.getCorrectInnerHTML(this.element);return b&&(c=this.parent.parse(c)),c=a.lang.string(c).replace(a.INVISIBLE_SPACE).by("")},setValue:function(a,b){b&&(a=this.parent.parse(a));try{this.element.innerHTML=a}catch(b){this.element.innerText=a}},show:function(){this.iframe.style.display=this._displayStyle||"",this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=b.getStyle("display").from(this.iframe),"none"===this._displayStyle&&(this._displayStyle=null),this.iframe.style.display="none"},disable:function(){this.parent.fire("disable:composer"),this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer"),this.element.setAttribute("contentEditable","true")},focus:function(b){a.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var c=this.element.lastChild;b&&c&&("BR"===c.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return b.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==this.textarea.element.getAttribute("placeholder")&&this.placeholderSet},isEmpty:function(){var a=this.element.innerHTML.toLowerCase();return""===a||"<br>"===a||"<p></p>"===a||"<p><br></p>"===a||this.hasPlaceholderSet()},_initSandbox:function(){var a=this;this.sandbox=new b.Sandbox(function(){a._create()},{stylesheets:this.config.stylesheets}),this.iframe=this.sandbox.getIframe();var c=this.textarea.element;if(b.insert(this.iframe).after(c),c.form){var d=document.createElement("input");d.type="hidden",d.name="_wysihtml5_mode",d.value=1,b.insert(d).after(c)}},_create:function(){var d=this;this.doc=this.sandbox.getDocument(),this.element=this.doc.body,this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0),this.selection=new a.Selection(this.parent),this.commands=new a.Commands(this.parent),b.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),b.addClass(this.element,this.config.composerClassName),this.config.style&&this.style(),this.observe();var e=this.config.name;e&&(b.addClass(this.element,e),b.addClass(this.iframe,e)),this.enable(),this.textarea.element.disabled&&this.disable();var f="string"==typeof this.config.placeholder?this.config.placeholder:this.textarea.element.getAttribute("placeholder");f&&b.simulatePlaceholder(this.parent,this,f),this.commands.exec("styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),this._initUndoManager(),this._initLineBreaking(),!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||c.isIos()||setTimeout(function(){d.focus(!0)},100),c.clearsContentEditableCorrectly()||a.quirks.ensureProperClearing(this),this.initSync&&this.config.sync&&this.initSync(),this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var d=this,e=c.canDisableAutoLinking(),f=c.doesAutoLinkingInContentEditable();if(e&&this.commands.exec("autoUrlDetect",!1),this.config.autoLink){(!f||f&&e)&&(this.parent.on("newword:composer",function(){b.getTextContent(d.element).match(b.autoLink.URL_REG_EXP)&&d.selection.executeAndRestore(function(a,c){b.autoLink(c.parentNode)})}),b.observe(this.element,"blur",function(){b.autoLink(d.element)}));var g=this.sandbox.getDocument().getElementsByTagName("a"),h=b.autoLink.URL_REG_EXP,i=function(c){var d=a.lang.string(b.getTextContent(c)).trim();return"www."===d.substr(0,4)&&(d="http://"+d),d};b.observe(this.element,"keydown",function(a){if(g.length){var f,c=d.selection.getSelectedNode(a.target.ownerDocument),e=b.getParentElement(c,{nodeName:"A"},4);e&&(f=i(e),setTimeout(function(){var a=i(e);a!==f&&a.match(h)&&e.setAttribute("href",a)},0))}})}},_initObjectResizing:function(){if(this.commands.exec("enableObjectResizing",!0),c.supportsEvent("resizeend")){var d=["width","height"],e=d.length,f=this.element;b.observe(f,"resizeend",function(b){var i,c=b.target||b.srcElement,g=c.style,h=0;
if("IMG"===c.nodeName){for(;h<e;h++)i=d[h],g[i]&&(c.setAttribute(i,parseInt(g[i],10)),g[i]="");a.quirks.redraw(f)}})}},_initUndoManager:function(){this.undoManager=new a.UndoManager(this.parent)},_initLineBreaking:function(){function g(a){var c=b.getParentElement(a,{nodeName:["P","DIV"]},2);c&&d.selection.executeAndRestore(function(){d.config.useLineBreaks?b.replaceWithChildNodes(c):"P"!==c.nodeName&&b.renameElement(c,"p")})}var d=this,e=["LI","P","H1","H2","H3","H4","H5","H6"],f=["UL","OL","MENU"];this.config.useLineBreaks||b.observe(this.element,["focus","keydown"],function(){if(d.isEmpty()){var a=d.doc.createElement("P");d.element.innerHTML="",d.element.appendChild(a),c.displaysCaretInEmptyContentEditableCorrectly()?d.selection.selectNode(a,!0):(a.innerHTML="<br>",d.selection.setBefore(a.firstChild))}}),b.observe(this.doc,"keydown",function(c){var h=c.keyCode;if(!c.shiftKey&&(h===a.ENTER_KEY||h===a.BACKSPACE_KEY)){var i=b.getParentElement(d.selection.getSelectedNode(),{nodeName:e},4);return i?void setTimeout(function(){var e,c=d.selection.getSelectedNode();if("LI"===i.nodeName){if(!c)return;e=b.getParentElement(c,{nodeName:f},2),e||g(c)}h===a.ENTER_KEY&&i.nodeName.match(/^H[1-6]$/)&&g(c)},0):void(d.config.useLineBreaks&&h===a.ENTER_KEY&&!a.browser.insertsLineBreaksOnReturn()&&(d.commands.exec("insertLineBreak"),c.preventDefault()))}})}})}(wysihtml5),function(a){var b=a.dom,c=document,d=window,e=c.createElement("div"),f=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],g=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],h=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",a.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],i=function(a){if(a.setActive)try{a.setActive()}catch(a){}else{var e=a.style,f=c.documentElement.scrollTop||c.body.scrollTop,g=c.documentElement.scrollLeft||c.body.scrollLeft,h={position:e.position,top:e.top,left:e.left,WebkitUserSelect:e.WebkitUserSelect};b.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(a),a.focus(),b.setStyles(h).on(a),d.scrollTo&&d.scrollTo(g,f)}};a.views.Composer.prototype.style=function(){var p,d=this,j=c.querySelector(":focus"),k=this.textarea.element,l=k.hasAttribute("placeholder"),m=l&&k.getAttribute("placeholder"),n=k.style.display,o=k.disabled;this.focusStylesHost=e.cloneNode(!1),this.blurStylesHost=e.cloneNode(!1),this.disabledStylesHost=e.cloneNode(!1),l&&k.removeAttribute("placeholder"),k===j&&k.blur(),k.disabled=!1,k.style.display=p="none",(k.getAttribute("rows")&&"auto"===b.getStyle("height").from(k)||k.getAttribute("cols")&&"auto"===b.getStyle("width").from(k))&&(k.style.display=p=n),b.copyStyles(g).from(k).to(this.iframe).andTo(this.blurStylesHost),b.copyStyles(f).from(k).to(this.element).andTo(this.blurStylesHost),b.insertCSS(h).into(this.element.ownerDocument),k.disabled=!0,b.copyStyles(g).from(k).to(this.disabledStylesHost),b.copyStyles(f).from(k).to(this.disabledStylesHost),k.disabled=o,k.style.display=n,i(k),k.style.display=p,b.copyStyles(g).from(k).to(this.focusStylesHost),b.copyStyles(f).from(k).to(this.focusStylesHost),k.style.display=n,b.copyStyles(["display"]).from(k).to(this.iframe);var q=a.lang.array(g).without(["display"]);return j?j.focus():k.blur(),l&&k.setAttribute("placeholder",m),this.parent.on("focus:composer",function(){b.copyStyles(q).from(d.focusStylesHost).to(d.iframe),b.copyStyles(f).from(d.focusStylesHost).to(d.element)}),this.parent.on("blur:composer",function(){b.copyStyles(q).from(d.blurStylesHost).to(d.iframe),b.copyStyles(f).from(d.blurStylesHost).to(d.element)}),this.parent.observe("disable:composer",function(){b.copyStyles(q).from(d.disabledStylesHost).to(d.iframe),b.copyStyles(f).from(d.disabledStylesHost).to(d.element)}),this.parent.observe("enable:composer",function(){b.copyStyles(q).from(d.blurStylesHost).to(d.iframe),b.copyStyles(f).from(d.blurStylesHost).to(d.element)}),this}}(wysihtml5),function(a){var b=a.dom,c=a.browser,d={66:"bold",73:"italic",85:"underline"};a.views.Composer.prototype.observe=function(){var e=this,f=this.getValue(),g=this.sandbox.getIframe(),h=this.element,i=c.supportsEventsInIframeCorrectly()?h:this.sandbox.getWindow(),j=["drop","paste"];b.observe(g,"DOMNodeRemoved",function(){clearInterval(k),e.parent.fire("destroy:composer")});var k=setInterval(function(){b.contains(document.documentElement,g)||(clearInterval(k),e.parent.fire("destroy:composer"))},250);b.observe(i,"focus",function(){e.parent.fire("focus").fire("focus:composer"),setTimeout(function(){f=e.getValue()},0)}),b.observe(i,"blur",function(){f!==e.getValue()&&e.parent.fire("change").fire("change:composer"),e.parent.fire("blur").fire("blur:composer")}),b.observe(h,"dragenter",function(){e.parent.fire("unset_placeholder")}),b.observe(h,j,function(){setTimeout(function(){e.parent.fire("paste").fire("paste:composer")},0)}),b.observe(h,"keyup",function(b){var c=b.keyCode;c!==a.SPACE_KEY&&c!==a.ENTER_KEY||e.parent.fire("newword:composer")}),this.parent.on("paste:composer",function(){setTimeout(function(){e.parent.fire("newword:composer")},0)}),c.canSelectImagesInContentEditable()||b.observe(h,"mousedown",function(a){var b=a.target;"IMG"===b.nodeName&&(e.selection.selectNode(b),a.preventDefault())}),c.hasHistoryIssue()&&c.supportsSelectionModify()&&b.observe(h,"keydown",function(a){if(a.metaKey||a.ctrlKey){var b=a.keyCode,c=h.ownerDocument.defaultView,d=c.getSelection();37!==b&&39!==b||(37===b&&(d.modify("extend","left","lineboundary"),a.shiftKey||d.collapseToStart()),39===b&&(d.modify("extend","right","lineboundary"),a.shiftKey||d.collapseToEnd()),a.preventDefault())}}),b.observe(h,"keydown",function(a){var b=a.keyCode,c=d[b];(a.ctrlKey||a.metaKey)&&!a.altKey&&c&&(e.commands.exec(c),a.preventDefault())}),b.observe(h,"keydown",function(b){var f,c=e.selection.getSelectedNode(!0),d=b.keyCode;!c||"IMG"!==c.nodeName||d!==a.BACKSPACE_KEY&&d!==a.DELETE_KEY||(f=c.parentNode,f.removeChild(c),"A"!==f.nodeName||f.firstChild||f.parentNode.removeChild(f),setTimeout(function(){a.quirks.redraw(h)},0),b.preventDefault())}),c.hasIframeFocusIssue()&&(b.observe(this.iframe,"focus",function(){setTimeout(function(){e.doc.querySelector(":focus")!==e.element&&e.focus()},0)}),b.observe(this.element,"blur",function(){setTimeout(function(){e.selection.getSelection().removeAllRanges()},0)}));var l={IMG:"Image: ",A:"Link: "};b.observe(h,"mouseover",function(a){var d,b=a.target,c=b.nodeName;if("A"===c||"IMG"===c){var e=b.hasAttribute("title");e||(d=l[c]+(b.getAttribute("href")||b.getAttribute("src")),b.setAttribute("title",d))}})}}(wysihtml5),function(a){var b=400;a.views.Synchronizer=Base.extend({constructor:function(a,b,c){this.editor=a,this.textarea=b,this.composer=c,this._observe()},fromComposerToTextarea:function(b){this.textarea.setValue(a.lang.string(this.composer.getValue()).trim(),b)},fromTextareaToComposer:function(a){var b=this.textarea.getValue();b?this.composer.setValue(b,a):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(a){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(a):this.fromComposerToTextarea(a)},_observe:function(){var c,d=this,e=this.textarea.element.form,f=function(){c=setInterval(function(){d.fromComposerToTextarea()},b)},g=function(){clearInterval(c),c=null};f(),e&&(a.dom.observe(e,"submit",function(){d.sync(!0)}),a.dom.observe(e,"reset",function(){setTimeout(function(){d.fromTextareaToComposer()},0)})),this.editor.on("change_view",function(a){"composer"!==a||c?"textarea"===a&&(d.fromComposerToTextarea(!0),g()):(d.fromTextareaToComposer(!0),f())}),this.editor.on("destroy:composer",g)}})}(wysihtml5),wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(a,b,c){this.base(a,b,c),this._observe()},clear:function(){this.element.value=""},getValue:function(a){var b=this.isEmpty()?"":this.element.value;return a&&(b=this.parent.parse(b)),b},setValue:function(a,b){b&&(a=this.parent.parse(a)),this.element.value=a},hasPlaceholderSet:function(){var a=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),b=this.element.getAttribute("placeholder")||null,c=this.element.value,d=!c;return a&&d||c===b},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var a=this.element,b=this.parent,c={focusin:"focus",focusout:"blur"},d=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];b.on("beforeload",function(){wysihtml5.dom.observe(a,d,function(a){var d=c[a.type]||a.type;b.fire(d).fire(d+":textarea")}),wysihtml5.dom.observe(a,["paste","drop"],function(){setTimeout(function(){b.fire("paste").fire("paste:textarea")},0)})})}}),function(a){var b=a.dom,c="wysihtml5-command-dialog-opened",d="input, select, textarea",e="[data-wysihtml5-dialog-field]",f="data-wysihtml5-dialog-field";a.toolbar.Dialog=a.lang.Dispatcher.extend({constructor:function(a,b){this.link=a,this.container=b},_observe:function(){if(!this._observed){var e=this,f=function(a){var b=e._serialize();b==e.elementToChange?e.fire("edit",b):e.fire("save",b),e.hide(),a.preventDefault(),a.stopPropagation()};b.observe(e.link,"click",function(){b.hasClass(e.link,c)&&setTimeout(function(){e.hide()},0)}),b.observe(this.container,"keydown",function(b){var c=b.keyCode;c===a.ENTER_KEY&&f(b),c===a.ESCAPE_KEY&&e.hide()}),b.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",f),b.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(a){e.fire("cancel"),e.hide(),a.preventDefault(),a.stopPropagation()});for(var g=this.container.querySelectorAll(d),h=0,i=g.length,j=function(){clearInterval(e.interval)};h<i;h++)b.observe(g[h],"change",j);this._observed=!0}},_serialize:function(){for(var a=this.elementToChange||{},b=this.container.querySelectorAll(e),c=b.length,d=0;d<c;d++)a[b[d].getAttribute(f)]=b[d].value;return a},_interpolate:function(a){for(var b,c,d,g=document.querySelector(":focus"),h=this.container.querySelectorAll(e),i=h.length,j=0;j<i;j++)b=h[j],b!==g&&(a&&"hidden"===b.type||(c=b.getAttribute(f),d=this.elementToChange?this.elementToChange[c]||"":b.defaultValue,b.value=d))},show:function(a){if(!b.hasClass(this.link,c)){var e=this,f=this.container.querySelector(d);if(this.elementToChange=a,this._observe(),this._interpolate(),a&&(this.interval=setInterval(function(){e._interpolate(!0)},500)),b.addClass(this.link,c),this.container.style.display="",this.fire("show"),f&&!a)try{f.focus()}catch(a){}}},hide:function(){clearInterval(this.interval),this.elementToChange=null,b.removeClass(this.link,c),this.container.style.display="none",this.fire("hide")}})}(wysihtml5),function(a){var b=a.dom,c={position:"relative"},d={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},e={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},f={"x-webkit-speech":"",speech:""};a.toolbar.Speech=function(g,h){var i=document.createElement("input");if(!a.browser.supportsSpeechApiOn(i))return void(h.style.display="none");var j=g.editor.textarea.element.getAttribute("lang");j&&(f.lang=j);var k=document.createElement("div");a.lang.object(d).merge({width:h.offsetWidth+"px",height:h.offsetHeight+"px"}),b.insert(i).into(k),b.insert(k).into(h),b.setStyles(e).on(i),b.setAttributes(f).on(i),b.setStyles(d).on(k),b.setStyles(c).on(h);var l="onwebkitspeechchange"in i?"webkitspeechchange":"speechchange";b.observe(i,l,function(){g.execCommand("insertText",i.value),i.value=""}),b.observe(i,"click",function(a){b.hasClass(h,"wysihtml5-command-disabled")&&a.preventDefault(),a.stopPropagation()})}}(wysihtml5),function(a){var b="wysihtml5-command-disabled",c="wysihtml5-commands-disabled",d="wysihtml5-command-active",e="wysihtml5-action-active",f=a.dom;a.toolbar.Toolbar=Base.extend({constructor:function(b,c){this.editor=b,this.container="string"==typeof c?document.getElementById(c):c,this.composer=b.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),this.show();for(var d=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),e=d.length,f=0;f<e;f++)new a.toolbar.Speech(this,d[f])},_getLinks:function(b){for(var g,h,i,j,k,c=this[b+"Links"]=a.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+b+"]")).get(),d=c.length,e=0,f=this[b+"Mapping"]={};e<d;e++)g=c[e],i=g.getAttribute("data-wysihtml5-"+b),j=g.getAttribute("data-wysihtml5-"+b+"-value"),h=this.container.querySelector("[data-wysihtml5-"+b+"-group='"+i+"']"),k=this._getDialog(g,i),f[i+":"+j]={link:g,group:h,name:i,value:j,dialog:k,state:!1}},_getDialog:function(b,c){var f,g,d=this,e=this.container.querySelector("[data-wysihtml5-dialog='"+c+"']");return e&&(f=new a.toolbar.Dialog(b,e),f.on("show",function(){g=d.composer.selection.getBookmark(),d.editor.fire("show:dialog",{command:c,dialogContainer:e,commandLink:b})}),f.on("save",function(a){g&&d.composer.selection.setBookmark(g),d._execCommand(c,a),d.editor.fire("save:dialog",{command:c,dialogContainer:e,commandLink:b})}),f.on("cancel",function(){d.editor.focus(!1),d.editor.fire("cancel:dialog",{command:c,dialogContainer:e,commandLink:b})})),f},execCommand:function(a,b){if(!this.commandsDisabled){var c=this.commandMapping[a+":"+b];c&&c.dialog&&!c.state?c.dialog.show():this._execCommand(a,b)}},_execCommand:function(a,b){this.editor.focus(!1),this.composer.commands.exec(a,b),this._updateLinkStates()},execAction:function(a){var b=this.editor;"change_view"===a&&(b.currentView===b.textarea?b.fire("change_view","composer"):b.fire("change_view","textarea"))},_observe:function(){for(var a=this,b=this.editor,d=this.container,e=this.commandLinks.concat(this.actionLinks),g=e.length,h=0;h<g;h++)f.setAttributes({href:"javascript:;",unselectable:"on"}).on(e[h]);f.delegate(d,"[data-wysihtml5-command], [data-wysihtml5-action]","mousedown",function(a){a.preventDefault()}),f.delegate(d,"[data-wysihtml5-command]","click",function(b){var c=this,d=c.getAttribute("data-wysihtml5-command"),e=c.getAttribute("data-wysihtml5-command-value");a.execCommand(d,e),b.preventDefault()}),f.delegate(d,"[data-wysihtml5-action]","click",function(b){var c=this.getAttribute("data-wysihtml5-action");a.execAction(c),b.preventDefault()}),b.on("focus:composer",function(){a.bookmark=null,clearInterval(a.interval),a.interval=setInterval(function(){a._updateLinkStates()},500)}),b.on("blur:composer",function(){clearInterval(a.interval)}),b.on("destroy:composer",function(){clearInterval(a.interval)}),b.on("change_view",function(b){setTimeout(function(){a.commandsDisabled="composer"!==b,a._updateLinkStates(),a.commandsDisabled?f.addClass(d,c):f.removeClass(d,c)},0)})},_updateLinkStates:function(){var h,i,j,k,c=this.commandMapping,g=this.actionMapping;for(h in c)k=c[h],this.commandsDisabled?(i=!1,f.removeClass(k.link,d),k.group&&f.removeClass(k.group,d),k.dialog&&k.dialog.hide()):(i=this.composer.commands.state(k.name,k.value),a.lang.object(i).isArray()&&(i=1!==i.length||i[0]),f.removeClass(k.link,b),k.group&&f.removeClass(k.group,b)),k.state!==i&&(k.state=i,i?(f.addClass(k.link,d),k.group&&f.addClass(k.group,d),k.dialog&&("object"==typeof i?k.dialog.show(i):k.dialog.hide())):(f.removeClass(k.link,d),k.group&&f.removeClass(k.group,d),k.dialog&&k.dialog.hide()));for(h in g)j=g[h],"change_view"===j.name&&(j.state=this.editor.currentView===this.editor.textarea,j.state?f.addClass(j.link,e):f.removeClass(j.link,e))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),function(a){var b,c={name:b,style:!0,toolbar:b,autoLink:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},parser:a.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",useLineBreaks:!0,stylesheets:[],placeholderText:b,supportTouchDevices:!0};a.Editor=a.lang.Dispatcher.extend({constructor:function(b,d){if(this.textareaElement="string"==typeof b?document.getElementById(b):b,this.config=a.lang.object({}).merge(c).merge(d).get(),this.textarea=new a.views.Textarea(this,this.textareaElement,this.config),this.currentView=this.textarea,this._isCompatible=a.browser.supported(),!this._isCompatible||!this.config.supportTouchDevices&&a.browser.isTouchDevice()){var e=this;return void setTimeout(function(){e.fire("beforeload").fire("load")},0)}a.dom.addClass(document.body,this.config.bodyClassName),this.composer=new a.views.Composer(this,this.textareaElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.on("beforeload",function(){this.synchronizer=new a.views.Synchronizer(this,this.textarea,this.composer),this.config.toolbar&&(this.toolbar=new a.toolbar.Toolbar(this,this.config.toolbar))});try{console.log("Heya! This page is using wysihtml5 for rich text editing. Check out https://github.com/xing/wysihtml5")}catch(a){}},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(a){return this.currentView.getValue(a)},setValue:function(a,b){return this.fire("unset_placeholder"),a?(this.currentView.setValue(a,b),this):this.clear()},focus:function(a){return this.currentView.focus(a),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(b){var c=this.config.parser(b,this.config.parserRules,this.composer.sandbox.getDocument(),!0);return"object"==typeof b&&a.quirks.redraw(b),c},_initParser:function(){this.on("paste:composer",function(){var b=!0,c=this;c.composer.selection.executeAndRestore(function(){a.quirks.cleanPastedHTML(c.composer.element),c.parse(c.composer.element)},b)})}})}(wysihtml5);